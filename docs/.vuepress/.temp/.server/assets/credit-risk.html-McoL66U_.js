import { ssrRenderAttrs, ssrRenderStyle } from "vue/server-renderer";
import { useSSRContext } from "vue";
import { _ as _export_sfc } from "../app.DfozzGWd.mjs";
import "@vuepress/shared";
import "vue-router";
import "@vueuse/core";
import "@vue/devtools-api";
const _sfc_main = {};
function _sfc_ssrRender(_ctx, _push, _parent, _attrs) {
  _push(`<div${ssrRenderAttrs(_attrs)}><h1 id="信用风险评估" tabindex="-1"><a class="header-anchor" href="#信用风险评估"><span>信用风险评估</span></a></h1><div class="knowledge-card"><div class="knowledge-card__title"><span class="icon">📚</span>项目概述 </div><div class="knowledge-card__content"><ul><li><strong>难度</strong>：高级</li><li><strong>类型</strong>：分类</li><li><strong>技能点</strong>：不平衡数据处理、特征工程、模型解释、评估指标选择</li><li><strong>对应知识模块</strong>：<a href="/core/classification/svm.html">分类算法</a></li></ul></div></div><h2 id="项目背景" tabindex="-1"><a class="header-anchor" href="#项目背景"><span>项目背景</span></a></h2><p>信用风险评估是金融机构的核心业务之一，用于判断借款人是否有能力按时偿还贷款。准确的信用风险评估可以帮助金融机构降低坏账率，同时为更多合格的借款人提供金融服务。</p><p>传统的信用评分模型主要依赖于借款人的信用历史、收入水平和债务比率等因素。随着大数据和机器学习技术的发展，现代信用风险评估可以整合更多维度的数据，包括交易行为、社交网络和心理特征等，构建更全面和准确的风险预测模型。</p><p>在这个项目中，我们将使用德国信用数据集，构建一个信用风险评估模型，预测借款人是否会违约。</p><div class="knowledge-card"><div class="knowledge-card__title"><span class="icon">💡</span>你知道吗？ </div><div class="knowledge-card__content"><p>信用评分的概念最早由美国公平艾萨克公司(Fair Isaac Corporation)在1950年代提出，发展成为今天广泛使用的FICO评分系统。现代信用评分系统通常将借款人的信用状况量化为300-850之间的分数，分数越高表示信用风险越低。</p></div></div><h2 id="数据集介绍" tabindex="-1"><a class="header-anchor" href="#数据集介绍"><span>数据集介绍</span></a></h2><p>德国信用数据集包含1000名借款人的信息，每个借款人有20个特征，包括：</p><ul><li>个人信息：年龄、性别、婚姻状况等</li><li>财务状况：收入、储蓄、现有信贷数量等</li><li>就业信息：就业类型、就业年限等</li><li>住房信息：住房类型、居住时间等</li><li>信用历史：过往信用记录、贷款目的等</li></ul><p>目标变量是二元分类：好客户(0)或坏客户(1)，其中坏客户表示存在违约风险。</p><p>数据集的一个重要特点是类别不平衡，好客户占70%，坏客户占30%。这种不平衡反映了现实世界中的信用风险分布，但也给模型训练带来了挑战。</p><h2 id="项目目标" tabindex="-1"><a class="header-anchor" href="#项目目标"><span>项目目标</span></a></h2><ol><li>构建一个能够准确预测借款人信用风险的分类模型</li><li>处理数据集中的类别不平衡问题</li><li>识别影响信用风险的关键因素</li><li>评估模型在不同评估指标下的表现</li><li>提供模型解释和业务建议</li></ol><h2 id="实施步骤" tabindex="-1"><a class="header-anchor" href="#实施步骤"><span>实施步骤</span></a></h2><h3 id="_1-数据探索与预处理" tabindex="-1"><a class="header-anchor" href="#_1-数据探索与预处理"><span>1. 数据探索与预处理</span></a></h3><p>首先，我们需要了解数据的基本特征和质量：</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd</span>
<span class="line"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np</span>
<span class="line"><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt</span>
<span class="line"><span class="token keyword">import</span> seaborn <span class="token keyword">as</span> sns</span>
<span class="line"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> train_test_split</span>
<span class="line"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>preprocessing <span class="token keyword">import</span> StandardScaler<span class="token punctuation">,</span> OneHotEncoder</span>
<span class="line"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>compose <span class="token keyword">import</span> ColumnTransformer</span>
<span class="line"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>pipeline <span class="token keyword">import</span> Pipeline</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 加载数据</span></span>
<span class="line">url <span class="token operator">=</span> <span class="token string">&quot;https://archive.ics.uci.edu/ml/machine-learning-databases/statlog/german/german.data&quot;</span></span>
<span class="line">column_names <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&#39;status&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;duration&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;credit_history&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;purpose&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;amount&#39;</span><span class="token punctuation">,</span> </span>
<span class="line">                <span class="token string">&#39;savings&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;employment_duration&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;installment_rate&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;personal_status_sex&#39;</span><span class="token punctuation">,</span> </span>
<span class="line">                <span class="token string">&#39;other_debtors&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;present_residence&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;property&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;age&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;other_installment_plans&#39;</span><span class="token punctuation">,</span> </span>
<span class="line">                <span class="token string">&#39;housing&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;existing_credits&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;job&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;num_dependents&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;telephone&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;foreign_worker&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;target&#39;</span><span class="token punctuation">]</span></span>
<span class="line">df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span>url<span class="token punctuation">,</span> sep<span class="token operator">=</span><span class="token string">&#39; &#39;</span><span class="token punctuation">,</span> header<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> names<span class="token operator">=</span>column_names<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 将目标变量转换为0和1（原始数据中是1和2）</span></span>
<span class="line">df<span class="token punctuation">[</span><span class="token string">&#39;target&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token string">&#39;target&#39;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 查看数据基本信息</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>df<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>df<span class="token punctuation">.</span>describe<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 检查类别分布</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token string">&#39;target&#39;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value_counts<span class="token punctuation">(</span>normalize<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 可视化类别分布</span></span>
<span class="line">plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">sns<span class="token punctuation">.</span>countplot<span class="token punctuation">(</span>x<span class="token operator">=</span><span class="token string">&#39;target&#39;</span><span class="token punctuation">,</span> data<span class="token operator">=</span>df<span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">&#39;信用风险分布&#39;</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">&#39;风险类别 (0=好客户, 1=坏客户)&#39;</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">&#39;数量&#39;</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 探索数值特征与目标变量的关系</span></span>
<span class="line">numerical_features <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&#39;duration&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;amount&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;age&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;existing_credits&#39;</span><span class="token punctuation">]</span></span>
<span class="line">fig<span class="token punctuation">,</span> axes <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">axes <span class="token operator">=</span> axes<span class="token punctuation">.</span>flatten<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">for</span> i<span class="token punctuation">,</span> feature <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>numerical_features<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    sns<span class="token punctuation">.</span>boxplot<span class="token punctuation">(</span>x<span class="token operator">=</span><span class="token string">&#39;target&#39;</span><span class="token punctuation">,</span> y<span class="token operator">=</span>feature<span class="token punctuation">,</span> data<span class="token operator">=</span>df<span class="token punctuation">,</span> ax<span class="token operator">=</span>axes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line">    axes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&#39;</span><span class="token interpolation"><span class="token punctuation">{</span>feature<span class="token punctuation">}</span></span><span class="token string"> vs 信用风险&#39;</span></span><span class="token punctuation">)</span></span>
<span class="line">    axes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>set_xlabel<span class="token punctuation">(</span><span class="token string">&#39;风险类别 (0=好客户, 1=坏客户)&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">plt<span class="token punctuation">.</span>tight_layout<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 探索类别特征与目标变量的关系</span></span>
<span class="line">categorical_features <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&#39;credit_history&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;purpose&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;personal_status_sex&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;savings&#39;</span><span class="token punctuation">]</span></span>
<span class="line">fig<span class="token punctuation">,</span> axes <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">axes <span class="token operator">=</span> axes<span class="token punctuation">.</span>flatten<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">for</span> i<span class="token punctuation">,</span> feature <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>categorical_features<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    cross_tab <span class="token operator">=</span> pd<span class="token punctuation">.</span>crosstab<span class="token punctuation">(</span>df<span class="token punctuation">[</span>feature<span class="token punctuation">]</span><span class="token punctuation">,</span> df<span class="token punctuation">[</span><span class="token string">&#39;target&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> normalize<span class="token operator">=</span><span class="token string">&#39;index&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    cross_tab<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>kind<span class="token operator">=</span><span class="token string">&#39;bar&#39;</span><span class="token punctuation">,</span> stacked<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> ax<span class="token operator">=</span>axes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line">    axes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&#39;</span><span class="token interpolation"><span class="token punctuation">{</span>feature<span class="token punctuation">}</span></span><span class="token string"> vs 信用风险&#39;</span></span><span class="token punctuation">)</span></span>
<span class="line">    axes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>set_xlabel<span class="token punctuation">(</span>feature<span class="token punctuation">)</span></span>
<span class="line">    axes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>set_ylabel<span class="token punctuation">(</span><span class="token string">&#39;比例&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    axes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>legend<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#39;好客户&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;坏客户&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">plt<span class="token punctuation">.</span>tight_layout<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="${ssrRenderStyle({ "counter-reset": "line-number 0" })}"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>接下来，我们需要处理数据中的类别特征和数值特征：</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># 识别数值特征和类别特征</span></span>
<span class="line">numerical_features <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&#39;duration&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;amount&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;installment_rate&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;present_residence&#39;</span><span class="token punctuation">,</span> </span>
<span class="line">                      <span class="token string">&#39;age&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;existing_credits&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;num_dependents&#39;</span><span class="token punctuation">]</span></span>
<span class="line">categorical_features <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&#39;status&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;credit_history&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;purpose&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;savings&#39;</span><span class="token punctuation">,</span> </span>
<span class="line">                        <span class="token string">&#39;employment_duration&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;personal_status_sex&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;other_debtors&#39;</span><span class="token punctuation">,</span> </span>
<span class="line">                        <span class="token string">&#39;property&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;other_installment_plans&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;housing&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;job&#39;</span><span class="token punctuation">,</span> </span>
<span class="line">                        <span class="token string">&#39;telephone&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;foreign_worker&#39;</span><span class="token punctuation">]</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 分割数据</span></span>
<span class="line">X <span class="token operator">=</span> df<span class="token punctuation">.</span>drop<span class="token punctuation">(</span><span class="token string">&#39;target&#39;</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">y <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token string">&#39;target&#39;</span><span class="token punctuation">]</span></span>
<span class="line">X_train<span class="token punctuation">,</span> X_test<span class="token punctuation">,</span> y_train<span class="token punctuation">,</span> y_test <span class="token operator">=</span> train_test_split<span class="token punctuation">(</span>X<span class="token punctuation">,</span> y<span class="token punctuation">,</span> test_size<span class="token operator">=</span><span class="token number">0.2</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">,</span> stratify<span class="token operator">=</span>y<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 创建预处理管道</span></span>
<span class="line">preprocessor <span class="token operator">=</span> ColumnTransformer<span class="token punctuation">(</span></span>
<span class="line">    transformers<span class="token operator">=</span><span class="token punctuation">[</span></span>
<span class="line">        <span class="token punctuation">(</span><span class="token string">&#39;num&#39;</span><span class="token punctuation">,</span> StandardScaler<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> numerical_features<span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token punctuation">(</span><span class="token string">&#39;cat&#39;</span><span class="token punctuation">,</span> OneHotEncoder<span class="token punctuation">(</span>drop<span class="token operator">=</span><span class="token string">&#39;first&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> categorical_features<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 应用预处理</span></span>
<span class="line">X_train_processed <span class="token operator">=</span> preprocessor<span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>X_train<span class="token punctuation">)</span></span>
<span class="line">X_test_processed <span class="token operator">=</span> preprocessor<span class="token punctuation">.</span>transform<span class="token punctuation">(</span>X_test<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 检查处理后的特征维度</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;处理后的训练集形状: </span><span class="token interpolation"><span class="token punctuation">{</span>X_train_processed<span class="token punctuation">.</span>shape<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="${ssrRenderStyle({ "counter-reset": "line-number 0" })}"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-处理类别不平衡" tabindex="-1"><a class="header-anchor" href="#_2-处理类别不平衡"><span>2. 处理类别不平衡</span></a></h3><p>信用风险数据通常存在类别不平衡问题，我们可以使用多种方法处理：</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">from</span> imblearn<span class="token punctuation">.</span>over_sampling <span class="token keyword">import</span> SMOTE</span>
<span class="line"><span class="token keyword">from</span> imblearn<span class="token punctuation">.</span>under_sampling <span class="token keyword">import</span> RandomUnderSampler</span>
<span class="line"><span class="token keyword">from</span> imblearn<span class="token punctuation">.</span>pipeline <span class="token keyword">import</span> Pipeline <span class="token keyword">as</span> ImbPipeline</span>
<span class="line"><span class="token keyword">from</span> collections <span class="token keyword">import</span> Counter</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 查看原始类别分布</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;原始训练集类别分布: </span><span class="token interpolation"><span class="token punctuation">{</span>Counter<span class="token punctuation">(</span>y_train<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 使用SMOTE过采样</span></span>
<span class="line">smote <span class="token operator">=</span> SMOTE<span class="token punctuation">(</span>random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">)</span></span>
<span class="line">X_train_smote<span class="token punctuation">,</span> y_train_smote <span class="token operator">=</span> smote<span class="token punctuation">.</span>fit_resample<span class="token punctuation">(</span>X_train_processed<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;SMOTE后训练集类别分布: </span><span class="token interpolation"><span class="token punctuation">{</span>Counter<span class="token punctuation">(</span>y_train_smote<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 使用随机欠采样</span></span>
<span class="line">rus <span class="token operator">=</span> RandomUnderSampler<span class="token punctuation">(</span>random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">)</span></span>
<span class="line">X_train_rus<span class="token punctuation">,</span> y_train_rus <span class="token operator">=</span> rus<span class="token punctuation">.</span>fit_resample<span class="token punctuation">(</span>X_train_processed<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;欠采样后训练集类别分布: </span><span class="token interpolation"><span class="token punctuation">{</span>Counter<span class="token punctuation">(</span>y_train_rus<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 使用组合采样（SMOTE + 欠采样）</span></span>
<span class="line">over <span class="token operator">=</span> SMOTE<span class="token punctuation">(</span>sampling_strategy<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">)</span>  <span class="token comment"># 将少数类过采样到多数类的50%</span></span>
<span class="line">under <span class="token operator">=</span> RandomUnderSampler<span class="token punctuation">(</span>sampling_strategy<span class="token operator">=</span><span class="token number">0.8</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">)</span>  <span class="token comment"># 将多数类欠采样到少数类的80%</span></span>
<span class="line">combined_sampling <span class="token operator">=</span> ImbPipeline<span class="token punctuation">(</span>steps<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">&#39;over&#39;</span><span class="token punctuation">,</span> over<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">&#39;under&#39;</span><span class="token punctuation">,</span> under<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line">X_train_combined<span class="token punctuation">,</span> y_train_combined <span class="token operator">=</span> combined_sampling<span class="token punctuation">.</span>fit_resample<span class="token punctuation">(</span>X_train_processed<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;组合采样后训练集类别分布: </span><span class="token interpolation"><span class="token punctuation">{</span>Counter<span class="token punctuation">(</span>y_train_combined<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="${ssrRenderStyle({ "counter-reset": "line-number 0" })}"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-模型训练与评估" tabindex="-1"><a class="header-anchor" href="#_3-模型训练与评估"><span>3. 模型训练与评估</span></a></h3><p>我们将尝试多种分类算法，并使用适合不平衡数据的评估指标：</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>linear_model <span class="token keyword">import</span> LogisticRegression</span>
<span class="line"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>ensemble <span class="token keyword">import</span> RandomForestClassifier<span class="token punctuation">,</span> GradientBoostingClassifier</span>
<span class="line"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>svm <span class="token keyword">import</span> SVC</span>
<span class="line"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>metrics <span class="token keyword">import</span> accuracy_score<span class="token punctuation">,</span> precision_score<span class="token punctuation">,</span> recall_score<span class="token punctuation">,</span> f1_score<span class="token punctuation">,</span> roc_auc_score</span>
<span class="line"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>metrics <span class="token keyword">import</span> confusion_matrix<span class="token punctuation">,</span> classification_report<span class="token punctuation">,</span> roc_curve<span class="token punctuation">,</span> precision_recall_curve</span>
<span class="line"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> cross_val_score</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 定义评估函数</span></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">evaluate_model</span><span class="token punctuation">(</span>model<span class="token punctuation">,</span> X_train<span class="token punctuation">,</span> y_train<span class="token punctuation">,</span> X_test<span class="token punctuation">,</span> y_test<span class="token punctuation">,</span> model_name<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token comment"># 训练模型</span></span>
<span class="line">    model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment"># 预测</span></span>
<span class="line">    y_pred <span class="token operator">=</span> model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_test<span class="token punctuation">)</span></span>
<span class="line">    y_prob <span class="token operator">=</span> model<span class="token punctuation">.</span>predict_proba<span class="token punctuation">(</span>X_test<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment"># 计算评估指标</span></span>
<span class="line">    accuracy <span class="token operator">=</span> accuracy_score<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> y_pred<span class="token punctuation">)</span></span>
<span class="line">    precision <span class="token operator">=</span> precision_score<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> y_pred<span class="token punctuation">)</span></span>
<span class="line">    recall <span class="token operator">=</span> recall_score<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> y_pred<span class="token punctuation">)</span></span>
<span class="line">    f1 <span class="token operator">=</span> f1_score<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> y_pred<span class="token punctuation">)</span></span>
<span class="line">    auc <span class="token operator">=</span> roc_auc_score<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> y_prob<span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment"># 打印评估结果</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;\\n</span><span class="token interpolation"><span class="token punctuation">{</span>model_name<span class="token punctuation">}</span></span><span class="token string"> 评估结果:&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;准确率: </span><span class="token interpolation"><span class="token punctuation">{</span>accuracy<span class="token punctuation">:</span><span class="token format-spec">.4f</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;精确率: </span><span class="token interpolation"><span class="token punctuation">{</span>precision<span class="token punctuation">:</span><span class="token format-spec">.4f</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;召回率: </span><span class="token interpolation"><span class="token punctuation">{</span>recall<span class="token punctuation">:</span><span class="token format-spec">.4f</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;F1分数: </span><span class="token interpolation"><span class="token punctuation">{</span>f1<span class="token punctuation">:</span><span class="token format-spec">.4f</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;AUC: </span><span class="token interpolation"><span class="token punctuation">{</span>auc<span class="token punctuation">:</span><span class="token format-spec">.4f</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment"># 混淆矩阵</span></span>
<span class="line">    cm <span class="token operator">=</span> confusion_matrix<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> y_pred<span class="token punctuation">)</span></span>
<span class="line">    plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    sns<span class="token punctuation">.</span>heatmap<span class="token punctuation">(</span>cm<span class="token punctuation">,</span> annot<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> fmt<span class="token operator">=</span><span class="token string">&#39;d&#39;</span><span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">&#39;Blues&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&#39;</span><span class="token interpolation"><span class="token punctuation">{</span>model_name<span class="token punctuation">}</span></span><span class="token string"> 混淆矩阵&#39;</span></span><span class="token punctuation">)</span></span>
<span class="line">    plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">&#39;预测类别&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">&#39;真实类别&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment"># ROC曲线</span></span>
<span class="line">    fpr<span class="token punctuation">,</span> tpr<span class="token punctuation">,</span> _ <span class="token operator">=</span> roc_curve<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> y_prob<span class="token punctuation">)</span></span>
<span class="line">    plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>fpr<span class="token punctuation">,</span> tpr<span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string-interpolation"><span class="token string">f&#39;AUC = </span><span class="token interpolation"><span class="token punctuation">{</span>auc<span class="token punctuation">:</span><span class="token format-spec">.4f</span><span class="token punctuation">}</span></span><span class="token string">&#39;</span></span><span class="token punctuation">)</span></span>
<span class="line">    plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">&#39;k--&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">&#39;假正例率&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">&#39;真正例率&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&#39;</span><span class="token interpolation"><span class="token punctuation">{</span>model_name<span class="token punctuation">}</span></span><span class="token string"> ROC曲线&#39;</span></span><span class="token punctuation">)</span></span>
<span class="line">    plt<span class="token punctuation">.</span>legend<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment"># 精确率-召回率曲线</span></span>
<span class="line">    precision_curve<span class="token punctuation">,</span> recall_curve<span class="token punctuation">,</span> _ <span class="token operator">=</span> precision_recall_curve<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> y_prob<span class="token punctuation">)</span></span>
<span class="line">    plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>recall_curve<span class="token punctuation">,</span> precision_curve<span class="token punctuation">)</span></span>
<span class="line">    plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">&#39;召回率&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">&#39;精确率&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&#39;</span><span class="token interpolation"><span class="token punctuation">{</span>model_name<span class="token punctuation">}</span></span><span class="token string"> 精确率-召回率曲线&#39;</span></span><span class="token punctuation">)</span></span>
<span class="line">    plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">return</span> model<span class="token punctuation">,</span> accuracy<span class="token punctuation">,</span> precision<span class="token punctuation">,</span> recall<span class="token punctuation">,</span> f1<span class="token punctuation">,</span> auc</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 训练和评估多个模型</span></span>
<span class="line">models <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token string">&#39;Logistic Regression&#39;</span><span class="token punctuation">:</span> LogisticRegression<span class="token punctuation">(</span>class_weight<span class="token operator">=</span><span class="token string">&#39;balanced&#39;</span><span class="token punctuation">,</span> max_iter<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&#39;Random Forest&#39;</span><span class="token punctuation">:</span> RandomForestClassifier<span class="token punctuation">(</span>class_weight<span class="token operator">=</span><span class="token string">&#39;balanced&#39;</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&#39;Gradient Boosting&#39;</span><span class="token punctuation">:</span> GradientBoostingClassifier<span class="token punctuation">(</span>random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&#39;SVM&#39;</span><span class="token punctuation">:</span> SVC<span class="token punctuation">(</span>class_weight<span class="token operator">=</span><span class="token string">&#39;balanced&#39;</span><span class="token punctuation">,</span> probability<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">results <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token keyword">for</span> name<span class="token punctuation">,</span> model <span class="token keyword">in</span> models<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    model_result <span class="token operator">=</span> evaluate_model<span class="token punctuation">(</span>model<span class="token punctuation">,</span> X_train_smote<span class="token punctuation">,</span> y_train_smote<span class="token punctuation">,</span> X_test_processed<span class="token punctuation">,</span> y_test<span class="token punctuation">,</span> name<span class="token punctuation">)</span></span>
<span class="line">    results<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span><span class="token punctuation">)</span> <span class="token operator">+</span> model_result<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 比较不同模型的性能</span></span>
<span class="line">results_df <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>results<span class="token punctuation">,</span> columns<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&#39;Model&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;Accuracy&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;Precision&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;Recall&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;F1&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;AUC&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\\n模型性能比较:&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>results_df<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 可视化比较</span></span>
<span class="line">plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">metrics <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&#39;Accuracy&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;Precision&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;Recall&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;F1&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;AUC&#39;</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token keyword">for</span> i<span class="token punctuation">,</span> metric <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>metrics<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">    sns<span class="token punctuation">.</span>barplot<span class="token punctuation">(</span>x<span class="token operator">=</span><span class="token string">&#39;Model&#39;</span><span class="token punctuation">,</span> y<span class="token operator">=</span>metric<span class="token punctuation">,</span> data<span class="token operator">=</span>results_df<span class="token punctuation">)</span></span>
<span class="line">    plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span>metric<span class="token punctuation">)</span></span>
<span class="line">    plt<span class="token punctuation">.</span>xticks<span class="token punctuation">(</span>rotation<span class="token operator">=</span><span class="token number">45</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>tight_layout<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="${ssrRenderStyle({ "counter-reset": "line-number 0" })}"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-特征重要性分析" tabindex="-1"><a class="header-anchor" href="#_4-特征重要性分析"><span>4. 特征重要性分析</span></a></h3><p>了解哪些特征对信用风险预测最重要：</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># 使用随机森林的特征重要性</span></span>
<span class="line">rf_model <span class="token operator">=</span> models<span class="token punctuation">[</span><span class="token string">&#39;Random Forest&#39;</span><span class="token punctuation">]</span></span>
<span class="line">feature_names <span class="token operator">=</span> numerical_features <span class="token operator">+</span> <span class="token builtin">list</span><span class="token punctuation">(</span>preprocessor<span class="token punctuation">.</span>named_transformers_<span class="token punctuation">[</span><span class="token string">&#39;cat&#39;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>get_feature_names_out<span class="token punctuation">(</span>categorical_features<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 获取特征重要性</span></span>
<span class="line">importances <span class="token operator">=</span> rf_model<span class="token punctuation">.</span>feature_importances_</span>
<span class="line">indices <span class="token operator">=</span> np<span class="token punctuation">.</span>argsort<span class="token punctuation">(</span>importances<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 可视化前15个重要特征</span></span>
<span class="line">plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">&#39;特征重要性&#39;</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>bar<span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">,</span> importances<span class="token punctuation">[</span>indices<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">15</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> align<span class="token operator">=</span><span class="token string">&#39;center&#39;</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>xticks<span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>feature_names<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> indices<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">15</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> rotation<span class="token operator">=</span><span class="token number">90</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>tight_layout<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 使用SHAP值进行更详细的解释</span></span>
<span class="line"><span class="token keyword">import</span> shap</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 选择一个模型进行解释（例如，随机森林）</span></span>
<span class="line">explainer <span class="token operator">=</span> shap<span class="token punctuation">.</span>TreeExplainer<span class="token punctuation">(</span>rf_model<span class="token punctuation">)</span></span>
<span class="line">shap_values <span class="token operator">=</span> explainer<span class="token punctuation">.</span>shap_values<span class="token punctuation">(</span>X_test_processed<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 可视化SHAP值</span></span>
<span class="line">plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">shap<span class="token punctuation">.</span>summary_plot<span class="token punctuation">(</span>shap_values<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> X_test_processed<span class="token punctuation">,</span> feature_names<span class="token operator">=</span>feature_names<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="${ssrRenderStyle({ "counter-reset": "line-number 0" })}"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-模型优化" tabindex="-1"><a class="header-anchor" href="#_5-模型优化"><span>5. 模型优化</span></a></h3><p>使用交叉验证和网格搜索优化最佳模型：</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> GridSearchCV</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 假设随机森林是最佳模型</span></span>
<span class="line">best_model <span class="token operator">=</span> RandomForestClassifier<span class="token punctuation">(</span>class_weight<span class="token operator">=</span><span class="token string">&#39;balanced&#39;</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 定义参数网格</span></span>
<span class="line">param_grid <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token string">&#39;n_estimators&#39;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&#39;max_depth&#39;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&#39;min_samples_split&#39;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&#39;min_samples_leaf&#39;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 使用网格搜索找到最佳参数</span></span>
<span class="line">grid_search <span class="token operator">=</span> GridSearchCV<span class="token punctuation">(</span></span>
<span class="line">    estimator<span class="token operator">=</span>best_model<span class="token punctuation">,</span></span>
<span class="line">    param_grid<span class="token operator">=</span>param_grid<span class="token punctuation">,</span></span>
<span class="line">    cv<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span></span>
<span class="line">    scoring<span class="token operator">=</span><span class="token string">&#39;f1&#39;</span><span class="token punctuation">,</span>  <span class="token comment"># 使用F1分数作为优化目标</span></span>
<span class="line">    n_jobs<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">grid_search<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train_smote<span class="token punctuation">,</span> y_train_smote<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 打印最佳参数</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;最佳参数:&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>grid_search<span class="token punctuation">.</span>best_params_<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 使用最佳参数的模型进行评估</span></span>
<span class="line">best_rf <span class="token operator">=</span> grid_search<span class="token punctuation">.</span>best_estimator_</span>
<span class="line">evaluate_model<span class="token punctuation">(</span>best_rf<span class="token punctuation">,</span> X_train_smote<span class="token punctuation">,</span> y_train_smote<span class="token punctuation">,</span> X_test_processed<span class="token punctuation">,</span> y_test<span class="token punctuation">,</span> <span class="token string">&quot;优化后的随机森林&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="${ssrRenderStyle({ "counter-reset": "line-number 0" })}"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-阈值优化" tabindex="-1"><a class="header-anchor" href="#_6-阈值优化"><span>6. 阈值优化</span></a></h3><p>在信用风险评估中，错误分类的成本是不对称的。我们可以通过调整分类阈值来平衡精确率和召回率：</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># 获取预测概率</span></span>
<span class="line">y_prob <span class="token operator">=</span> best_rf<span class="token punctuation">.</span>predict_proba<span class="token punctuation">(</span>X_test_processed<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 计算不同阈值下的精确率和召回率</span></span>
<span class="line">thresholds <span class="token operator">=</span> np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0.01</span><span class="token punctuation">)</span></span>
<span class="line">precision_scores <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></span>
<span class="line">recall_scores <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></span>
<span class="line">f1_scores <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">for</span> threshold <span class="token keyword">in</span> thresholds<span class="token punctuation">:</span></span>
<span class="line">    y_pred_threshold <span class="token operator">=</span> <span class="token punctuation">(</span>y_prob <span class="token operator">&gt;=</span> threshold<span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span></span>
<span class="line">    precision_scores<span class="token punctuation">.</span>append<span class="token punctuation">(</span>precision_score<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> y_pred_threshold<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    recall_scores<span class="token punctuation">.</span>append<span class="token punctuation">(</span>recall_score<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> y_pred_threshold<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    f1_scores<span class="token punctuation">.</span>append<span class="token punctuation">(</span>f1_score<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> y_pred_threshold<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 可视化不同阈值下的性能</span></span>
<span class="line">plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>thresholds<span class="token punctuation">,</span> precision_scores<span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">&#39;精确率&#39;</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>thresholds<span class="token punctuation">,</span> recall_scores<span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">&#39;召回率&#39;</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>thresholds<span class="token punctuation">,</span> f1_scores<span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">&#39;F1分数&#39;</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">&#39;阈值&#39;</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">&#39;分数&#39;</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">&#39;不同阈值下的模型性能&#39;</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>legend<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>grid<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 找到F1分数最高的阈值</span></span>
<span class="line">best_threshold <span class="token operator">=</span> thresholds<span class="token punctuation">[</span>np<span class="token punctuation">.</span>argmax<span class="token punctuation">(</span>f1_scores<span class="token punctuation">)</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;最佳阈值: </span><span class="token interpolation"><span class="token punctuation">{</span>best_threshold<span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;在最佳阈值下的F1分数: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">max</span><span class="token punctuation">(</span>f1_scores<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token format-spec">.4f</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 使用最佳阈值进行最终预测</span></span>
<span class="line">y_pred_final <span class="token operator">=</span> <span class="token punctuation">(</span>y_prob <span class="token operator">&gt;=</span> best_threshold<span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\\n使用最佳阈值的最终评估结果:&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>classification_report<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> y_pred_final<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="${ssrRenderStyle({ "counter-reset": "line-number 0" })}"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_7-业务解释与建议" tabindex="-1"><a class="header-anchor" href="#_7-业务解释与建议"><span>7. 业务解释与建议</span></a></h3><p>最后，我们需要将模型结果转化为业务洞察：</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># 计算拒绝率和坏账率</span></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">calculate_business_metrics</span><span class="token punctuation">(</span>y_true<span class="token punctuation">,</span> y_pred<span class="token punctuation">,</span> y_prob<span class="token punctuation">,</span> threshold<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token comment"># 使用给定阈值的预测</span></span>
<span class="line">    y_pred_threshold <span class="token operator">=</span> <span class="token punctuation">(</span>y_prob <span class="token operator">&gt;=</span> threshold<span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment"># 计算拒绝率（预测为坏客户的比例）</span></span>
<span class="line">    rejection_rate <span class="token operator">=</span> np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>y_pred_threshold<span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment"># 计算坏账率（在预测为好客户中实际为坏客户的比例）</span></span>
<span class="line">    approved_indices <span class="token operator">=</span> y_pred_threshold <span class="token operator">==</span> <span class="token number">0</span></span>
<span class="line">    <span class="token keyword">if</span> np<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span>approved_indices<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span></span>
<span class="line">        bad_debt_rate <span class="token operator">=</span> np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>y_true<span class="token punctuation">[</span>approved_indices<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">else</span><span class="token punctuation">:</span></span>
<span class="line">        bad_debt_rate <span class="token operator">=</span> <span class="token number">0</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">return</span> rejection_rate<span class="token punctuation">,</span> bad_debt_rate</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 计算不同阈值下的业务指标</span></span>
<span class="line">business_metrics <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token keyword">for</span> threshold <span class="token keyword">in</span> thresholds<span class="token punctuation">:</span></span>
<span class="line">    rejection_rate<span class="token punctuation">,</span> bad_debt_rate <span class="token operator">=</span> calculate_business_metrics<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> y_pred<span class="token punctuation">,</span> y_prob<span class="token punctuation">,</span> threshold<span class="token punctuation">)</span></span>
<span class="line">    business_metrics<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>threshold<span class="token punctuation">,</span> rejection_rate<span class="token punctuation">,</span> bad_debt_rate<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">business_df <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>business_metrics<span class="token punctuation">,</span> columns<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&#39;Threshold&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;Rejection Rate&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;Bad Debt Rate&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 可视化业务指标</span></span>
<span class="line">plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>business_df<span class="token punctuation">[</span><span class="token string">&#39;Threshold&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> business_df<span class="token punctuation">[</span><span class="token string">&#39;Rejection Rate&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">&#39;拒绝率&#39;</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>business_df<span class="token punctuation">[</span><span class="token string">&#39;Threshold&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> business_df<span class="token punctuation">[</span><span class="token string">&#39;Bad Debt Rate&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">&#39;坏账率&#39;</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">&#39;阈值&#39;</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">&#39;比率&#39;</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">&#39;不同阈值下的业务指标&#39;</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>legend<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>grid<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 根据业务目标选择阈值</span></span>
<span class="line"><span class="token comment"># 例如，如果我们希望坏账率不超过5%</span></span>
<span class="line">target_bad_debt <span class="token operator">=</span> <span class="token number">0.05</span></span>
<span class="line">valid_thresholds <span class="token operator">=</span> business_df<span class="token punctuation">[</span>business_df<span class="token punctuation">[</span><span class="token string">&#39;Bad Debt Rate&#39;</span><span class="token punctuation">]</span> <span class="token operator">&lt;=</span> target_bad_debt<span class="token punctuation">]</span></span>
<span class="line"><span class="token keyword">if</span> <span class="token keyword">not</span> valid_thresholds<span class="token punctuation">.</span>empty<span class="token punctuation">:</span></span>
<span class="line">    business_threshold <span class="token operator">=</span> valid_thresholds<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span>np<span class="token punctuation">.</span>argmin<span class="token punctuation">(</span>valid_thresholds<span class="token punctuation">[</span><span class="token string">&#39;Rejection Rate&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&#39;Threshold&#39;</span><span class="token punctuation">]</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;为达到坏账率不超过5%的目标，建议使用阈值: </span><span class="token interpolation"><span class="token punctuation">{</span>business_threshold<span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;在此阈值下的拒绝率: </span><span class="token interpolation"><span class="token punctuation">{</span>valid_thresholds<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span>np<span class="token punctuation">.</span>argmin<span class="token punctuation">(</span>valid_thresholds<span class="token punctuation">[</span><span class="token string">&#39;Rejection Rate&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&#39;Rejection Rate&#39;</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;在此阈值下的坏账率: </span><span class="token interpolation"><span class="token punctuation">{</span>valid_thresholds<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span>np<span class="token punctuation">.</span>argmin<span class="token punctuation">(</span>valid_thresholds<span class="token punctuation">[</span><span class="token string">&#39;Rejection Rate&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&#39;Bad Debt Rate&#39;</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">else</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;无法找到满足坏账率目标的阈值&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="${ssrRenderStyle({ "counter-reset": "line-number 0" })}"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="进阶挑战" tabindex="-1"><a class="header-anchor" href="#进阶挑战"><span>进阶挑战</span></a></h2><p>如果你已经完成了基本任务，可以尝试以下进阶挑战：</p><ol><li><strong>成本敏感学习</strong>：考虑不同类型错误的业务成本，构建成本敏感的模型</li><li><strong>特征工程进阶</strong>：创建交互特征、多项式特征或基于领域知识的特征</li><li><strong>模型解释进阶</strong>：使用LIME或SHAP等工具提供个体预测的解释</li><li><strong>公平性分析</strong>：评估模型在不同人口统计群体上的表现，检测和减轻潜在偏见</li><li><strong>部署考量</strong>：设计模型监控和更新策略，处理概念漂移问题</li></ol><h2 id="小结与反思" tabindex="-1"><a class="header-anchor" href="#小结与反思"><span>小结与反思</span></a></h2><p>通过这个项目，我们学习了如何构建信用风险评估模型，处理类别不平衡问题，并将模型结果转化为业务决策。信用风险评估是一个复杂的任务，需要平衡多种因素，包括预测准确性、业务目标和伦理考量。</p><p>在实际应用中，信用风险模型需要定期更新和监控，以适应不断变化的经济环境和客户行为。此外，模型的公平性和透明度也是重要的考量因素，确保信贷决策不会对特定群体造成不公平的影响。</p><h3 id="思考问题" tabindex="-1"><a class="header-anchor" href="#思考问题"><span>思考问题</span></a></h3><ol><li>在信用风险评估中，如何平衡模型的预测性能和可解释性需求？</li><li>不同的采样方法如何影响模型对少数类（高风险客户）的预测能力？</li><li>如何将信用风险模型与业务流程集成，使其成为有效的决策支持工具？</li></ol><div class="practice-link"><a href="/projects/clustering/customer-segmentation.html" class="button">下一个模块：聚类分析项目</a></div></div>`);
}
const _sfc_setup = _sfc_main.setup;
_sfc_main.setup = (props, ctx) => {
  const ssrContext = useSSRContext();
  (ssrContext.modules || (ssrContext.modules = /* @__PURE__ */ new Set())).add(".vuepress/.temp/pages/projects/classification/credit-risk.html.vue");
  return _sfc_setup ? _sfc_setup(props, ctx) : void 0;
};
const creditRisk_html = /* @__PURE__ */ _export_sfc(_sfc_main, [["ssrRender", _sfc_ssrRender], ["__file", "credit-risk.html.vue"]]);
const data = JSON.parse('{"path":"/projects/classification/credit-risk.html","title":"信用风险评估","lang":"zh-CN","frontmatter":{},"headers":[{"level":2,"title":"项目背景","slug":"项目背景","link":"#项目背景","children":[]},{"level":2,"title":"数据集介绍","slug":"数据集介绍","link":"#数据集介绍","children":[]},{"level":2,"title":"项目目标","slug":"项目目标","link":"#项目目标","children":[]},{"level":2,"title":"实施步骤","slug":"实施步骤","link":"#实施步骤","children":[{"level":3,"title":"1. 数据探索与预处理","slug":"_1-数据探索与预处理","link":"#_1-数据探索与预处理","children":[]},{"level":3,"title":"2. 处理类别不平衡","slug":"_2-处理类别不平衡","link":"#_2-处理类别不平衡","children":[]},{"level":3,"title":"3. 模型训练与评估","slug":"_3-模型训练与评估","link":"#_3-模型训练与评估","children":[]},{"level":3,"title":"4. 特征重要性分析","slug":"_4-特征重要性分析","link":"#_4-特征重要性分析","children":[]},{"level":3,"title":"5. 模型优化","slug":"_5-模型优化","link":"#_5-模型优化","children":[]},{"level":3,"title":"6. 阈值优化","slug":"_6-阈值优化","link":"#_6-阈值优化","children":[]},{"level":3,"title":"7. 业务解释与建议","slug":"_7-业务解释与建议","link":"#_7-业务解释与建议","children":[]}]},{"level":2,"title":"进阶挑战","slug":"进阶挑战","link":"#进阶挑战","children":[]},{"level":2,"title":"小结与反思","slug":"小结与反思","link":"#小结与反思","children":[{"level":3,"title":"思考问题","slug":"思考问题","link":"#思考问题","children":[]}]}],"git":{"updatedTime":1742460681000,"contributors":[{"name":"like45599","username":"like45599","email":"131803211+like45599@users.noreply.github.com","commits":1,"url":"https://github.com/like45599"}],"changelog":[{"hash":"61a31e55d1325755fa12a32e909ee09c3ac0a20f","time":1742460681000,"email":"131803211+like45599@users.noreply.github.com","author":"Yun Feng","message":"数据挖掘指南v1.0"}]},"filePathRelative":"projects/classification/credit-risk.md"}');
export {
  creditRisk_html as comp,
  data
};
