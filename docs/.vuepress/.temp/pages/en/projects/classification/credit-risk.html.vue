<template><div><h1 id="credit-risk-assessment" tabindex="-1"><a class="header-anchor" href="#credit-risk-assessment"><span>Credit Risk Assessment</span></a></h1>
<div class="knowledge-card">
  <div class="knowledge-card__title">
    <span class="icon">ðŸ“š</span>Project Overview
  </div>
  <div class="knowledge-card__content">
    <ul>
      <li><strong>Difficulty</strong>: Advanced</li>
      <li><strong>Type</strong>: Classification</li>
      <!-- <li><strong>Estimated Time</strong>: 6-8 hours</li> -->
      <li><strong>Skill Points</strong>: Handling imbalanced data, feature engineering, model interpretation, evaluation metric selection</li>
      <li><strong>Related Knowledge Module</strong>: <a href="/en/core/classification/svm.html">Classification Algorithms</a></li>
    </ul>
  </div>
</div>
<h2 id="project-background" tabindex="-1"><a class="header-anchor" href="#project-background"><span>Project Background</span></a></h2>
<p>Credit risk assessment is one of the core businesses of financial institutions, used to determine whether a borrower is capable of repaying a loan on time. Accurate credit risk assessment can help financial institutions reduce non-performing loans while providing financial services to more qualified borrowers.</p>
<p>Traditional credit scoring models mainly rely on factors such as a borrower's credit history, income level, and debt ratio. With the development of big data and machine learning technologies, modern credit risk assessment can integrate data from additional dimensionsâ€”including transaction behavior, social networks, and psychological characteristicsâ€”to build more comprehensive and accurate risk prediction models.</p>
<p>In this project, we will use the German credit dataset to build a credit risk assessment model that predicts whether a borrower will default.</p>
<div class="knowledge-card">
  <div class="knowledge-card__title">
    <span class="icon">ðŸ’¡</span>Did You Know?
  </div>
  <div class="knowledge-card__content">
    <p>The concept of credit scoring was first proposed by Fair Isaac Corporation in the 1950s and has since evolved into the widely used FICO scoring system. Modern credit scoring systems typically quantify a borrower's creditworthiness with scores ranging from 300 to 850, with higher scores indicating lower credit risk.</p>
  </div>
</div>
<h2 id="dataset-introduction" tabindex="-1"><a class="header-anchor" href="#dataset-introduction"><span>Dataset Introduction</span></a></h2>
<p>The German credit dataset contains information on 1000 borrowers, each with 20 features, including:</p>
<ul>
<li><strong>Personal Information</strong>: Age, gender, marital status, etc.</li>
<li><strong>Financial Status</strong>: Income, savings, number of existing credits, etc.</li>
<li><strong>Employment Information</strong>: Employment type, years of employment, etc.</li>
<li><strong>Housing Information</strong>: Housing type, duration of residence, etc.</li>
<li><strong>Credit History</strong>: Past credit records, loan purpose, etc.</li>
</ul>
<p>The target variable is binary: good customer (0) or bad customer (1), where a bad customer indicates a risk of default.</p>
<p>An important characteristic of the dataset is its class imbalanceâ€”good customers account for 70% while bad customers account for 30%. This imbalance reflects the real-world distribution of credit risk, but also poses challenges for model training.</p>
<h2 id="project-objectives" tabindex="-1"><a class="header-anchor" href="#project-objectives"><span>Project Objectives</span></a></h2>
<ol>
<li>Build a classification model that can accurately predict a borrower's credit risk</li>
<li>Address the class imbalance in the dataset</li>
<li>Identify the key factors influencing credit risk</li>
<li>Evaluate the model's performance using various metrics</li>
<li>Provide model interpretation and business recommendations</li>
</ol>
<h2 id="implementation-steps" tabindex="-1"><a class="header-anchor" href="#implementation-steps"><span>Implementation Steps</span></a></h2>
<h3 id="_1-data-exploration-and-preprocessing" tabindex="-1"><a class="header-anchor" href="#_1-data-exploration-and-preprocessing"><span>1. Data Exploration and Preprocessing</span></a></h3>
<p>First, we need to understand the basic characteristics and quality of the data:</p>
<div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre v-pre><code><span class="line"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd</span>
<span class="line"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np</span>
<span class="line"><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt</span>
<span class="line"><span class="token keyword">import</span> seaborn <span class="token keyword">as</span> sns</span>
<span class="line"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> train_test_split</span>
<span class="line"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>preprocessing <span class="token keyword">import</span> StandardScaler<span class="token punctuation">,</span> OneHotEncoder</span>
<span class="line"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>compose <span class="token keyword">import</span> ColumnTransformer</span>
<span class="line"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>pipeline <span class="token keyword">import</span> Pipeline</span>
<span class="line"></span>
<span class="line"><span class="token comment"># Load the data</span></span>
<span class="line">url <span class="token operator">=</span> <span class="token string">"https://archive.ics.uci.edu/ml/machine-learning-databases/statlog/german/german.data"</span></span>
<span class="line">column_names <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'status'</span><span class="token punctuation">,</span> <span class="token string">'duration'</span><span class="token punctuation">,</span> <span class="token string">'credit_history'</span><span class="token punctuation">,</span> <span class="token string">'purpose'</span><span class="token punctuation">,</span> <span class="token string">'amount'</span><span class="token punctuation">,</span> </span>
<span class="line">                <span class="token string">'savings'</span><span class="token punctuation">,</span> <span class="token string">'employment_duration'</span><span class="token punctuation">,</span> <span class="token string">'installment_rate'</span><span class="token punctuation">,</span> <span class="token string">'personal_status_sex'</span><span class="token punctuation">,</span> </span>
<span class="line">                <span class="token string">'other_debtors'</span><span class="token punctuation">,</span> <span class="token string">'present_residence'</span><span class="token punctuation">,</span> <span class="token string">'property'</span><span class="token punctuation">,</span> <span class="token string">'age'</span><span class="token punctuation">,</span> <span class="token string">'other_installment_plans'</span><span class="token punctuation">,</span> </span>
<span class="line">                <span class="token string">'housing'</span><span class="token punctuation">,</span> <span class="token string">'existing_credits'</span><span class="token punctuation">,</span> <span class="token string">'job'</span><span class="token punctuation">,</span> <span class="token string">'num_dependents'</span><span class="token punctuation">,</span> <span class="token string">'telephone'</span><span class="token punctuation">,</span> <span class="token string">'foreign_worker'</span><span class="token punctuation">,</span> <span class="token string">'target'</span><span class="token punctuation">]</span></span>
<span class="line">df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span>url<span class="token punctuation">,</span> sep<span class="token operator">=</span><span class="token string">' '</span><span class="token punctuation">,</span> header<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> names<span class="token operator">=</span>column_names<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Convert the target variable to 0 and 1 (the original data uses 1 and 2)</span></span>
<span class="line">df<span class="token punctuation">[</span><span class="token string">'target'</span><span class="token punctuation">]</span> <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token string">'target'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># View basic information about the data</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>df<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>df<span class="token punctuation">.</span>describe<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Check class distribution</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token string">'target'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value_counts<span class="token punctuation">(</span>normalize<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Visualize class distribution</span></span>
<span class="line">plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">sns<span class="token punctuation">.</span>countplot<span class="token punctuation">(</span>x<span class="token operator">=</span><span class="token string">'target'</span><span class="token punctuation">,</span> data<span class="token operator">=</span>df<span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'Credit Risk Distribution'</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'Risk Class (0 = Good Customer, 1 = Bad Customer)'</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'Count'</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Explore the relationship between numerical features and the target variable</span></span>
<span class="line">numerical_features <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'duration'</span><span class="token punctuation">,</span> <span class="token string">'amount'</span><span class="token punctuation">,</span> <span class="token string">'age'</span><span class="token punctuation">,</span> <span class="token string">'existing_credits'</span><span class="token punctuation">]</span></span>
<span class="line">fig<span class="token punctuation">,</span> axes <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">axes <span class="token operator">=</span> axes<span class="token punctuation">.</span>flatten<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">for</span> i<span class="token punctuation">,</span> feature <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>numerical_features<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    sns<span class="token punctuation">.</span>boxplot<span class="token punctuation">(</span>x<span class="token operator">=</span><span class="token string">'target'</span><span class="token punctuation">,</span> y<span class="token operator">=</span>feature<span class="token punctuation">,</span> data<span class="token operator">=</span>df<span class="token punctuation">,</span> ax<span class="token operator">=</span>axes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line">    axes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">{</span>feature<span class="token punctuation">}</span></span><span class="token string"> vs Credit Risk'</span></span><span class="token punctuation">)</span></span>
<span class="line">    axes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>set_xlabel<span class="token punctuation">(</span><span class="token string">'Risk Class (0 = Good Customer, 1 = Bad Customer)'</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">plt<span class="token punctuation">.</span>tight_layout<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Explore the relationship between categorical features and the target variable</span></span>
<span class="line">categorical_features <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'credit_history'</span><span class="token punctuation">,</span> <span class="token string">'purpose'</span><span class="token punctuation">,</span> <span class="token string">'personal_status_sex'</span><span class="token punctuation">,</span> <span class="token string">'savings'</span><span class="token punctuation">]</span></span>
<span class="line">fig<span class="token punctuation">,</span> axes <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">axes <span class="token operator">=</span> axes<span class="token punctuation">.</span>flatten<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">for</span> i<span class="token punctuation">,</span> feature <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>categorical_features<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    cross_tab <span class="token operator">=</span> pd<span class="token punctuation">.</span>crosstab<span class="token punctuation">(</span>df<span class="token punctuation">[</span>feature<span class="token punctuation">]</span><span class="token punctuation">,</span> df<span class="token punctuation">[</span><span class="token string">'target'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> normalize<span class="token operator">=</span><span class="token string">'index'</span><span class="token punctuation">)</span></span>
<span class="line">    cross_tab<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>kind<span class="token operator">=</span><span class="token string">'bar'</span><span class="token punctuation">,</span> stacked<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> ax<span class="token operator">=</span>axes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line">    axes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">{</span>feature<span class="token punctuation">}</span></span><span class="token string"> vs Credit Risk'</span></span><span class="token punctuation">)</span></span>
<span class="line">    axes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>set_xlabel<span class="token punctuation">(</span>feature<span class="token punctuation">)</span></span>
<span class="line">    axes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>set_ylabel<span class="token punctuation">(</span><span class="token string">'Proportion'</span><span class="token punctuation">)</span></span>
<span class="line">    axes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>legend<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'Good Customer'</span><span class="token punctuation">,</span> <span class="token string">'Bad Customer'</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">plt<span class="token punctuation">.</span>tight_layout<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Next, we need to process the categorical and numerical features in the data:</p>
<div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre v-pre><code><span class="line"><span class="token comment"># Identify numerical and categorical features</span></span>
<span class="line">numerical_features <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'duration'</span><span class="token punctuation">,</span> <span class="token string">'amount'</span><span class="token punctuation">,</span> <span class="token string">'installment_rate'</span><span class="token punctuation">,</span> <span class="token string">'present_residence'</span><span class="token punctuation">,</span> </span>
<span class="line">                      <span class="token string">'age'</span><span class="token punctuation">,</span> <span class="token string">'existing_credits'</span><span class="token punctuation">,</span> <span class="token string">'num_dependents'</span><span class="token punctuation">]</span></span>
<span class="line">categorical_features <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'status'</span><span class="token punctuation">,</span> <span class="token string">'credit_history'</span><span class="token punctuation">,</span> <span class="token string">'purpose'</span><span class="token punctuation">,</span> <span class="token string">'savings'</span><span class="token punctuation">,</span> </span>
<span class="line">                        <span class="token string">'employment_duration'</span><span class="token punctuation">,</span> <span class="token string">'personal_status_sex'</span><span class="token punctuation">,</span> <span class="token string">'other_debtors'</span><span class="token punctuation">,</span> </span>
<span class="line">                        <span class="token string">'property'</span><span class="token punctuation">,</span> <span class="token string">'other_installment_plans'</span><span class="token punctuation">,</span> <span class="token string">'housing'</span><span class="token punctuation">,</span> <span class="token string">'job'</span><span class="token punctuation">,</span> </span>
<span class="line">                        <span class="token string">'telephone'</span><span class="token punctuation">,</span> <span class="token string">'foreign_worker'</span><span class="token punctuation">]</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Split the data</span></span>
<span class="line">X <span class="token operator">=</span> df<span class="token punctuation">.</span>drop<span class="token punctuation">(</span><span class="token string">'target'</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">y <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token string">'target'</span><span class="token punctuation">]</span></span>
<span class="line">X_train<span class="token punctuation">,</span> X_test<span class="token punctuation">,</span> y_train<span class="token punctuation">,</span> y_test <span class="token operator">=</span> train_test_split<span class="token punctuation">(</span>X<span class="token punctuation">,</span> y<span class="token punctuation">,</span> test_size<span class="token operator">=</span><span class="token number">0.2</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">,</span> stratify<span class="token operator">=</span>y<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Create a preprocessing pipeline</span></span>
<span class="line">preprocessor <span class="token operator">=</span> ColumnTransformer<span class="token punctuation">(</span></span>
<span class="line">    transformers<span class="token operator">=</span><span class="token punctuation">[</span></span>
<span class="line">        <span class="token punctuation">(</span><span class="token string">'num'</span><span class="token punctuation">,</span> StandardScaler<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> numerical_features<span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token punctuation">(</span><span class="token string">'cat'</span><span class="token punctuation">,</span> OneHotEncoder<span class="token punctuation">(</span>drop<span class="token operator">=</span><span class="token string">'first'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> categorical_features<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Apply preprocessing</span></span>
<span class="line">X_train_processed <span class="token operator">=</span> preprocessor<span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>X_train<span class="token punctuation">)</span></span>
<span class="line">X_test_processed <span class="token operator">=</span> preprocessor<span class="token punctuation">.</span>transform<span class="token punctuation">(</span>X_test<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Check the shape of the processed features</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Processed training set shape: </span><span class="token interpolation"><span class="token punctuation">{</span>X_train_processed<span class="token punctuation">.</span>shape<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-handling-class-imbalance" tabindex="-1"><a class="header-anchor" href="#_2-handling-class-imbalance"><span>2. Handling Class Imbalance</span></a></h3>
<p>Credit risk data typically exhibits class imbalance issues, which can be addressed using various methods:</p>
<div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre v-pre><code><span class="line"><span class="token keyword">from</span> imblearn<span class="token punctuation">.</span>over_sampling <span class="token keyword">import</span> SMOTE</span>
<span class="line"><span class="token keyword">from</span> imblearn<span class="token punctuation">.</span>under_sampling <span class="token keyword">import</span> RandomUnderSampler</span>
<span class="line"><span class="token keyword">from</span> imblearn<span class="token punctuation">.</span>pipeline <span class="token keyword">import</span> Pipeline <span class="token keyword">as</span> ImbPipeline</span>
<span class="line"><span class="token keyword">from</span> collections <span class="token keyword">import</span> Counter</span>
<span class="line"></span>
<span class="line"><span class="token comment"># Check original class distribution</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Original training set class distribution: </span><span class="token interpolation"><span class="token punctuation">{</span>Counter<span class="token punctuation">(</span>y_train<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Apply SMOTE for oversampling</span></span>
<span class="line">smote <span class="token operator">=</span> SMOTE<span class="token punctuation">(</span>random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">)</span></span>
<span class="line">X_train_smote<span class="token punctuation">,</span> y_train_smote <span class="token operator">=</span> smote<span class="token punctuation">.</span>fit_resample<span class="token punctuation">(</span>X_train_processed<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Training set class distribution after SMOTE: </span><span class="token interpolation"><span class="token punctuation">{</span>Counter<span class="token punctuation">(</span>y_train_smote<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Apply random undersampling</span></span>
<span class="line">rus <span class="token operator">=</span> RandomUnderSampler<span class="token punctuation">(</span>random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">)</span></span>
<span class="line">X_train_rus<span class="token punctuation">,</span> y_train_rus <span class="token operator">=</span> rus<span class="token punctuation">.</span>fit_resample<span class="token punctuation">(</span>X_train_processed<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Training set class distribution after undersampling: </span><span class="token interpolation"><span class="token punctuation">{</span>Counter<span class="token punctuation">(</span>y_train_rus<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Apply combined sampling (SMOTE + undersampling)</span></span>
<span class="line">over <span class="token operator">=</span> SMOTE<span class="token punctuation">(</span>sampling_strategy<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">)</span>  <span class="token comment"># Oversample the minority class to 50% of the majority class</span></span>
<span class="line">under <span class="token operator">=</span> RandomUnderSampler<span class="token punctuation">(</span>sampling_strategy<span class="token operator">=</span><span class="token number">0.8</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">)</span>  <span class="token comment"># Undersample the majority class to 80% of the minority class</span></span>
<span class="line">combined_sampling <span class="token operator">=</span> ImbPipeline<span class="token punctuation">(</span>steps<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'over'</span><span class="token punctuation">,</span> over<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'under'</span><span class="token punctuation">,</span> under<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line">X_train_combined<span class="token punctuation">,</span> y_train_combined <span class="token operator">=</span> combined_sampling<span class="token punctuation">.</span>fit_resample<span class="token punctuation">(</span>X_train_processed<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Training set class distribution after combined sampling: </span><span class="token interpolation"><span class="token punctuation">{</span>Counter<span class="token punctuation">(</span>y_train_combined<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-model-training-and-evaluation" tabindex="-1"><a class="header-anchor" href="#_3-model-training-and-evaluation"><span>3. Model Training and Evaluation</span></a></h3>
<p>We will experiment with multiple classification algorithms and use evaluation metrics suitable for imbalanced data:</p>
<div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre v-pre><code><span class="line"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>linear_model <span class="token keyword">import</span> LogisticRegression</span>
<span class="line"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>ensemble <span class="token keyword">import</span> RandomForestClassifier<span class="token punctuation">,</span> GradientBoostingClassifier</span>
<span class="line"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>svm <span class="token keyword">import</span> SVC</span>
<span class="line"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>metrics <span class="token keyword">import</span> accuracy_score<span class="token punctuation">,</span> precision_score<span class="token punctuation">,</span> recall_score<span class="token punctuation">,</span> f1_score<span class="token punctuation">,</span> roc_auc_score</span>
<span class="line"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>metrics <span class="token keyword">import</span> confusion_matrix<span class="token punctuation">,</span> classification_report<span class="token punctuation">,</span> roc_curve<span class="token punctuation">,</span> precision_recall_curve</span>
<span class="line"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> cross_val_score</span>
<span class="line"></span>
<span class="line"><span class="token comment"># Define evaluation function</span></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">evaluate_model</span><span class="token punctuation">(</span>model<span class="token punctuation">,</span> X_train<span class="token punctuation">,</span> y_train<span class="token punctuation">,</span> X_test<span class="token punctuation">,</span> y_test<span class="token punctuation">,</span> model_name<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token comment"># Train the model</span></span>
<span class="line">    model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment"># Make predictions</span></span>
<span class="line">    y_pred <span class="token operator">=</span> model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_test<span class="token punctuation">)</span></span>
<span class="line">    y_prob <span class="token operator">=</span> model<span class="token punctuation">.</span>predict_proba<span class="token punctuation">(</span>X_test<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment"># Calculate evaluation metrics</span></span>
<span class="line">    accuracy <span class="token operator">=</span> accuracy_score<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> y_pred<span class="token punctuation">)</span></span>
<span class="line">    precision <span class="token operator">=</span> precision_score<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> y_pred<span class="token punctuation">)</span></span>
<span class="line">    recall <span class="token operator">=</span> recall_score<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> y_pred<span class="token punctuation">)</span></span>
<span class="line">    f1 <span class="token operator">=</span> f1_score<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> y_pred<span class="token punctuation">)</span></span>
<span class="line">    auc <span class="token operator">=</span> roc_auc_score<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> y_prob<span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment"># Print evaluation results</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"\n</span><span class="token interpolation"><span class="token punctuation">{</span>model_name<span class="token punctuation">}</span></span><span class="token string"> Evaluation Results:"</span></span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Accuracy: </span><span class="token interpolation"><span class="token punctuation">{</span>accuracy<span class="token punctuation">:</span><span class="token format-spec">.4f</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Precision: </span><span class="token interpolation"><span class="token punctuation">{</span>precision<span class="token punctuation">:</span><span class="token format-spec">.4f</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Recall: </span><span class="token interpolation"><span class="token punctuation">{</span>recall<span class="token punctuation">:</span><span class="token format-spec">.4f</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"F1 Score: </span><span class="token interpolation"><span class="token punctuation">{</span>f1<span class="token punctuation">:</span><span class="token format-spec">.4f</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"AUC: </span><span class="token interpolation"><span class="token punctuation">{</span>auc<span class="token punctuation">:</span><span class="token format-spec">.4f</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment"># Confusion matrix</span></span>
<span class="line">    cm <span class="token operator">=</span> confusion_matrix<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> y_pred<span class="token punctuation">)</span></span>
<span class="line">    plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    sns<span class="token punctuation">.</span>heatmap<span class="token punctuation">(</span>cm<span class="token punctuation">,</span> annot<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> fmt<span class="token operator">=</span><span class="token string">'d'</span><span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">'Blues'</span><span class="token punctuation">)</span></span>
<span class="line">    plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">{</span>model_name<span class="token punctuation">}</span></span><span class="token string"> Confusion Matrix'</span></span><span class="token punctuation">)</span></span>
<span class="line">    plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'Predicted Class'</span><span class="token punctuation">)</span></span>
<span class="line">    plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'True Class'</span><span class="token punctuation">)</span></span>
<span class="line">    plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment"># ROC curve</span></span>
<span class="line">    fpr<span class="token punctuation">,</span> tpr<span class="token punctuation">,</span> _ <span class="token operator">=</span> roc_curve<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> y_prob<span class="token punctuation">)</span></span>
<span class="line">    plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>fpr<span class="token punctuation">,</span> tpr<span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string-interpolation"><span class="token string">f'AUC = </span><span class="token interpolation"><span class="token punctuation">{</span>auc<span class="token punctuation">:</span><span class="token format-spec">.4f</span><span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span></span>
<span class="line">    plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'k--'</span><span class="token punctuation">)</span></span>
<span class="line">    plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'False Positive Rate'</span><span class="token punctuation">)</span></span>
<span class="line">    plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'True Positive Rate'</span><span class="token punctuation">)</span></span>
<span class="line">    plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">{</span>model_name<span class="token punctuation">}</span></span><span class="token string"> ROC Curve'</span></span><span class="token punctuation">)</span></span>
<span class="line">    plt<span class="token punctuation">.</span>legend<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment"># Precision-Recall curve</span></span>
<span class="line">    precision_curve<span class="token punctuation">,</span> recall_curve<span class="token punctuation">,</span> _ <span class="token operator">=</span> precision_recall_curve<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> y_prob<span class="token punctuation">)</span></span>
<span class="line">    plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>recall_curve<span class="token punctuation">,</span> precision_curve<span class="token punctuation">)</span></span>
<span class="line">    plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'Recall'</span><span class="token punctuation">)</span></span>
<span class="line">    plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'Precision'</span><span class="token punctuation">)</span></span>
<span class="line">    plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">{</span>model_name<span class="token punctuation">}</span></span><span class="token string"> Precision-Recall Curve'</span></span><span class="token punctuation">)</span></span>
<span class="line">    plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">return</span> model<span class="token punctuation">,</span> accuracy<span class="token punctuation">,</span> precision<span class="token punctuation">,</span> recall<span class="token punctuation">,</span> f1<span class="token punctuation">,</span> auc</span>
<span class="line"></span>
<span class="line"><span class="token comment"># Train and evaluate multiple models</span></span>
<span class="line">models <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token string">'Logistic Regression'</span><span class="token punctuation">:</span> LogisticRegression<span class="token punctuation">(</span>class_weight<span class="token operator">=</span><span class="token string">'balanced'</span><span class="token punctuation">,</span> max_iter<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">'Random Forest'</span><span class="token punctuation">:</span> RandomForestClassifier<span class="token punctuation">(</span>class_weight<span class="token operator">=</span><span class="token string">'balanced'</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">'Gradient Boosting'</span><span class="token punctuation">:</span> GradientBoostingClassifier<span class="token punctuation">(</span>random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">'SVM'</span><span class="token punctuation">:</span> SVC<span class="token punctuation">(</span>class_weight<span class="token operator">=</span><span class="token string">'balanced'</span><span class="token punctuation">,</span> probability<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">results <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token keyword">for</span> name<span class="token punctuation">,</span> model <span class="token keyword">in</span> models<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    model_result <span class="token operator">=</span> evaluate_model<span class="token punctuation">(</span>model<span class="token punctuation">,</span> X_train_smote<span class="token punctuation">,</span> y_train_smote<span class="token punctuation">,</span> X_test_processed<span class="token punctuation">,</span> y_test<span class="token punctuation">,</span> name<span class="token punctuation">)</span></span>
<span class="line">    results<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span><span class="token punctuation">)</span> <span class="token operator">+</span> model_result<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Compare the performance of different models</span></span>
<span class="line">results_df <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>results<span class="token punctuation">,</span> columns<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'Model'</span><span class="token punctuation">,</span> <span class="token string">'Accuracy'</span><span class="token punctuation">,</span> <span class="token string">'Precision'</span><span class="token punctuation">,</span> <span class="token string">'Recall'</span><span class="token punctuation">,</span> <span class="token string">'F1'</span><span class="token punctuation">,</span> <span class="token string">'AUC'</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\nModel Performance Comparison:"</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>results_df<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Visualize the comparison</span></span>
<span class="line">plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">metrics <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'Accuracy'</span><span class="token punctuation">,</span> <span class="token string">'Precision'</span><span class="token punctuation">,</span> <span class="token string">'Recall'</span><span class="token punctuation">,</span> <span class="token string">'F1'</span><span class="token punctuation">,</span> <span class="token string">'AUC'</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token keyword">for</span> i<span class="token punctuation">,</span> metric <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>metrics<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">    sns<span class="token punctuation">.</span>barplot<span class="token punctuation">(</span>x<span class="token operator">=</span><span class="token string">'Model'</span><span class="token punctuation">,</span> y<span class="token operator">=</span>metric<span class="token punctuation">,</span> data<span class="token operator">=</span>results_df<span class="token punctuation">)</span></span>
<span class="line">    plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span>metric<span class="token punctuation">)</span></span>
<span class="line">    plt<span class="token punctuation">.</span>xticks<span class="token punctuation">(</span>rotation<span class="token operator">=</span><span class="token number">45</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>tight_layout<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-feature-importance-analysis" tabindex="-1"><a class="header-anchor" href="#_4-feature-importance-analysis"><span>4. Feature Importance Analysis</span></a></h3>
<p>Understand which features are most important for predicting credit risk:</p>
<div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre v-pre><code><span class="line"><span class="token comment"># Use the feature importances from the Random Forest model</span></span>
<span class="line">rf_model <span class="token operator">=</span> models<span class="token punctuation">[</span><span class="token string">'Random Forest'</span><span class="token punctuation">]</span></span>
<span class="line">feature_names <span class="token operator">=</span> numerical_features <span class="token operator">+</span> <span class="token builtin">list</span><span class="token punctuation">(</span>preprocessor<span class="token punctuation">.</span>named_transformers_<span class="token punctuation">[</span><span class="token string">'cat'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>get_feature_names_out<span class="token punctuation">(</span>categorical_features<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Get feature importances</span></span>
<span class="line">importances <span class="token operator">=</span> rf_model<span class="token punctuation">.</span>feature_importances_</span>
<span class="line">indices <span class="token operator">=</span> np<span class="token punctuation">.</span>argsort<span class="token punctuation">(</span>importances<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Visualize the top 15 important features</span></span>
<span class="line">plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'Feature Importance'</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>bar<span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">,</span> importances<span class="token punctuation">[</span>indices<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">15</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> align<span class="token operator">=</span><span class="token string">'center'</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>xticks<span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>feature_names<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> indices<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">15</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> rotation<span class="token operator">=</span><span class="token number">90</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>tight_layout<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Use SHAP values for a more detailed explanation</span></span>
<span class="line"><span class="token keyword">import</span> shap</span>
<span class="line"></span>
<span class="line"><span class="token comment"># Choose a model for explanation (e.g., Random Forest)</span></span>
<span class="line">explainer <span class="token operator">=</span> shap<span class="token punctuation">.</span>TreeExplainer<span class="token punctuation">(</span>rf_model<span class="token punctuation">)</span></span>
<span class="line">shap_values <span class="token operator">=</span> explainer<span class="token punctuation">.</span>shap_values<span class="token punctuation">(</span>X_test_processed<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Visualize the SHAP summary plot</span></span>
<span class="line">plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">shap<span class="token punctuation">.</span>summary_plot<span class="token punctuation">(</span>shap_values<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> X_test_processed<span class="token punctuation">,</span> feature_names<span class="token operator">=</span>feature_names<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-model-optimization" tabindex="-1"><a class="header-anchor" href="#_5-model-optimization"><span>5. Model Optimization</span></a></h3>
<p>Optimize the best model using cross-validation and grid search:</p>
<div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre v-pre><code><span class="line"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> GridSearchCV</span>
<span class="line"></span>
<span class="line"><span class="token comment"># Assume Random Forest is the best model</span></span>
<span class="line">best_model <span class="token operator">=</span> RandomForestClassifier<span class="token punctuation">(</span>class_weight<span class="token operator">=</span><span class="token string">'balanced'</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Define the parameter grid</span></span>
<span class="line">param_grid <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token string">'n_estimators'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">'max_depth'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">'min_samples_split'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">'min_samples_leaf'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Use grid search to find the best parameters</span></span>
<span class="line">grid_search <span class="token operator">=</span> GridSearchCV<span class="token punctuation">(</span></span>
<span class="line">    estimator<span class="token operator">=</span>best_model<span class="token punctuation">,</span></span>
<span class="line">    param_grid<span class="token operator">=</span>param_grid<span class="token punctuation">,</span></span>
<span class="line">    cv<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span></span>
<span class="line">    scoring<span class="token operator">=</span><span class="token string">'f1'</span><span class="token punctuation">,</span>  <span class="token comment"># Using F1 score as the optimization metric</span></span>
<span class="line">    n_jobs<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">grid_search<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train_smote<span class="token punctuation">,</span> y_train_smote<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Print the best parameters</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Best Parameters:"</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>grid_search<span class="token punctuation">.</span>best_params_<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Evaluate the model with the best parameters</span></span>
<span class="line">best_rf <span class="token operator">=</span> grid_search<span class="token punctuation">.</span>best_estimator_</span>
<span class="line">evaluate_model<span class="token punctuation">(</span>best_rf<span class="token punctuation">,</span> X_train_smote<span class="token punctuation">,</span> y_train_smote<span class="token punctuation">,</span> X_test_processed<span class="token punctuation">,</span> y_test<span class="token punctuation">,</span> <span class="token string">"Optimized Random Forest"</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-threshold-optimization" tabindex="-1"><a class="header-anchor" href="#_6-threshold-optimization"><span>6. Threshold Optimization</span></a></h3>
<p>In credit risk assessment, the costs of misclassification are asymmetric. We can adjust the classification threshold to balance precision and recall:</p>
<div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre v-pre><code><span class="line"><span class="token comment"># Get prediction probabilities</span></span>
<span class="line">y_prob <span class="token operator">=</span> best_rf<span class="token punctuation">.</span>predict_proba<span class="token punctuation">(</span>X_test_processed<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Calculate precision and recall for different thresholds</span></span>
<span class="line">thresholds <span class="token operator">=</span> np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0.01</span><span class="token punctuation">)</span></span>
<span class="line">precision_scores <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></span>
<span class="line">recall_scores <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></span>
<span class="line">f1_scores <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">for</span> threshold <span class="token keyword">in</span> thresholds<span class="token punctuation">:</span></span>
<span class="line">    y_pred_threshold <span class="token operator">=</span> <span class="token punctuation">(</span>y_prob <span class="token operator">>=</span> threshold<span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span></span>
<span class="line">    precision_scores<span class="token punctuation">.</span>append<span class="token punctuation">(</span>precision_score<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> y_pred_threshold<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    recall_scores<span class="token punctuation">.</span>append<span class="token punctuation">(</span>recall_score<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> y_pred_threshold<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    f1_scores<span class="token punctuation">.</span>append<span class="token punctuation">(</span>f1_score<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> y_pred_threshold<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Visualize performance under different thresholds</span></span>
<span class="line">plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>thresholds<span class="token punctuation">,</span> precision_scores<span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'Precision'</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>thresholds<span class="token punctuation">,</span> recall_scores<span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'Recall'</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>thresholds<span class="token punctuation">,</span> f1_scores<span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'F1 Score'</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'Threshold'</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'Score'</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'Model Performance at Different Thresholds'</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>legend<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>grid<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Find the threshold with the highest F1 score</span></span>
<span class="line">best_threshold <span class="token operator">=</span> thresholds<span class="token punctuation">[</span>np<span class="token punctuation">.</span>argmax<span class="token punctuation">(</span>f1_scores<span class="token punctuation">)</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Best Threshold: </span><span class="token interpolation"><span class="token punctuation">{</span>best_threshold<span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Highest F1 Score at Best Threshold: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">max</span><span class="token punctuation">(</span>f1_scores<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token format-spec">.4f</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Make final predictions using the best threshold</span></span>
<span class="line">y_pred_final <span class="token operator">=</span> <span class="token punctuation">(</span>y_prob <span class="token operator">>=</span> best_threshold<span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\nFinal Evaluation with the Best Threshold:"</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>classification_report<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> y_pred_final<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_7-business-interpretation-and-recommendations" tabindex="-1"><a class="header-anchor" href="#_7-business-interpretation-and-recommendations"><span>7. Business Interpretation and Recommendations</span></a></h3>
<p>Finally, we need to translate the model results into business insights:</p>
<div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre v-pre><code><span class="line"><span class="token comment"># Calculate rejection rate and bad debt rate</span></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">calculate_business_metrics</span><span class="token punctuation">(</span>y_true<span class="token punctuation">,</span> y_pred<span class="token punctuation">,</span> y_prob<span class="token punctuation">,</span> threshold<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token comment"># Make predictions using the given threshold</span></span>
<span class="line">    y_pred_threshold <span class="token operator">=</span> <span class="token punctuation">(</span>y_prob <span class="token operator">>=</span> threshold<span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment"># Calculate rejection rate (the proportion predicted as bad customers)</span></span>
<span class="line">    rejection_rate <span class="token operator">=</span> np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>y_pred_threshold<span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment"># Calculate bad debt rate (the proportion of actual bad customers among those predicted as good)</span></span>
<span class="line">    approved_indices <span class="token operator">=</span> y_pred_threshold <span class="token operator">==</span> <span class="token number">0</span></span>
<span class="line">    <span class="token keyword">if</span> np<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span>approved_indices<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">:</span></span>
<span class="line">        bad_debt_rate <span class="token operator">=</span> np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>y_true<span class="token punctuation">[</span>approved_indices<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">else</span><span class="token punctuation">:</span></span>
<span class="line">        bad_debt_rate <span class="token operator">=</span> <span class="token number">0</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">return</span> rejection_rate<span class="token punctuation">,</span> bad_debt_rate</span>
<span class="line"></span>
<span class="line"><span class="token comment"># Calculate business metrics for different thresholds</span></span>
<span class="line">business_metrics <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token keyword">for</span> threshold <span class="token keyword">in</span> thresholds<span class="token punctuation">:</span></span>
<span class="line">    rejection_rate<span class="token punctuation">,</span> bad_debt_rate <span class="token operator">=</span> calculate_business_metrics<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> y_pred<span class="token punctuation">,</span> y_prob<span class="token punctuation">,</span> threshold<span class="token punctuation">)</span></span>
<span class="line">    business_metrics<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>threshold<span class="token punctuation">,</span> rejection_rate<span class="token punctuation">,</span> bad_debt_rate<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">business_df <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>business_metrics<span class="token punctuation">,</span> columns<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'Threshold'</span><span class="token punctuation">,</span> <span class="token string">'Rejection Rate'</span><span class="token punctuation">,</span> <span class="token string">'Bad Debt Rate'</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Visualize business metrics</span></span>
<span class="line">plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>business_df<span class="token punctuation">[</span><span class="token string">'Threshold'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> business_df<span class="token punctuation">[</span><span class="token string">'Rejection Rate'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'Rejection Rate'</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>business_df<span class="token punctuation">[</span><span class="token string">'Threshold'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> business_df<span class="token punctuation">[</span><span class="token string">'Bad Debt Rate'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'Bad Debt Rate'</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'Threshold'</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'Rate'</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'Business Metrics at Different Thresholds'</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>legend<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>grid<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Select a threshold based on business objectives</span></span>
<span class="line"><span class="token comment"># For example, if we want the bad debt rate to be no more than 5%</span></span>
<span class="line">target_bad_debt <span class="token operator">=</span> <span class="token number">0.05</span></span>
<span class="line">valid_thresholds <span class="token operator">=</span> business_df<span class="token punctuation">[</span>business_df<span class="token punctuation">[</span><span class="token string">'Bad Debt Rate'</span><span class="token punctuation">]</span> <span class="token operator">&lt;=</span> target_bad_debt<span class="token punctuation">]</span></span>
<span class="line"><span class="token keyword">if</span> <span class="token keyword">not</span> valid_thresholds<span class="token punctuation">.</span>empty<span class="token punctuation">:</span></span>
<span class="line">    business_threshold <span class="token operator">=</span> valid_thresholds<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span>np<span class="token punctuation">.</span>argmin<span class="token punctuation">(</span>valid_thresholds<span class="token punctuation">[</span><span class="token string">'Rejection Rate'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'Threshold'</span><span class="token punctuation">]</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"To keep the bad debt rate below 5%, it is recommended to use a threshold of: </span><span class="token interpolation"><span class="token punctuation">{</span>business_threshold<span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Rejection Rate at this threshold: </span><span class="token interpolation"><span class="token punctuation">{</span>valid_thresholds<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span>np<span class="token punctuation">.</span>argmin<span class="token punctuation">(</span>valid_thresholds<span class="token punctuation">[</span><span class="token string">'Rejection Rate'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'Rejection Rate'</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Bad Debt Rate at this threshold: </span><span class="token interpolation"><span class="token punctuation">{</span>valid_thresholds<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span>np<span class="token punctuation">.</span>argmin<span class="token punctuation">(</span>valid_thresholds<span class="token punctuation">[</span><span class="token string">'Rejection Rate'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'Bad Debt Rate'</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">else</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"No threshold found that meets the target bad debt rate."</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="advanced-challenge" tabindex="-1"><a class="header-anchor" href="#advanced-challenge"><span>Advanced challenge</span></a></h2>
<p>If you have already completed the basic tasks, you can try the following advanced challenges:</p>
<ol>
<li><strong>Cost-sensitive learning</strong> : Consider the business costs of different types of errors and build cost-sensitive models</li>
<li><strong>Feature Engineering Advanced</strong> : Create interactive features, polynomial features or features based on domain knowledge</li>
<li><strong>Advanced Model interpretation</strong> : Use tools such as LIME or SHAP to provide interpretation of individual predictions</li>
<li><strong>Fairness analysis</strong> : Evaluate the model's performance on different demographic groups to detect and mitigate potential bias</li>
<li><strong>Deployment considerations</strong> : Design model monitoring and update strategies to deal with concept drift</li>
</ol>
<h2 id="summary-and-reflections" tabindex="-1"><a class="header-anchor" href="#summary-and-reflections"><span>Summary and Reflections</span></a></h2>
<p>Through this project, we learned how to build a credit risk assessment model, address class imbalance issues, and translate model results into business decisions. Credit risk assessment is a complex task that requires balancing multiple factors, including prediction accuracy, business objectives, and ethical considerations.</p>
<p>In practical applications, credit risk models need to be updated and monitored regularly to adapt to the ever-changing economic environment and customer behavior. Additionally, the fairness and transparency of the model are important considerations to ensure that lending decisions do not unfairly impact specific groups.</p>
<h3 id="questions-for-reflection" tabindex="-1"><a class="header-anchor" href="#questions-for-reflection"><span>Questions for Reflection</span></a></h3>
<ol>
<li>How can we balance the trade-off between prediction performance and interpretability in credit risk assessment?</li>
<li>How do different sampling methods affect the model's ability to predict the minority class (high-risk customers)?</li>
<li>How can the credit risk model be integrated with business processes to serve as an effective decision support tool?</li>
</ol>
<div class="practice-link">
  <a href="/en/projects/clustering/customer-segmentation.html" class="button">Next Module: Customer Segmentation Project</a>
</div>
</div></template>


