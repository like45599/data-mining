# é”€å”®é¢é¢„æµ‹

<div class="knowledge-card">
  <div class="knowledge-card__title">
    <span class="icon">ğŸ“š</span>é¡¹ç›®æ¦‚è¿°
  </div>
  <div class="knowledge-card__content">
    <ul>
      <li><strong>éš¾åº¦</strong>ï¼šä¸­çº§</li>
      <li><strong>ç±»å‹</strong>ï¼šå›å½’ - ä¸­çº§</li>
      <!-- <li><strong>é¢„è®¡æ—¶é—´</strong>ï¼š4-6å°æ—¶</li> -->
      <li><strong>æŠ€èƒ½ç‚¹</strong>ï¼šæ—¶é—´åºåˆ—åˆ†æã€ç‰¹å¾å·¥ç¨‹ã€å›å½’æ¨¡å‹</li>
      <li><strong>å¯¹åº”çŸ¥è¯†æ¨¡å—</strong>ï¼š<a href="/core/regression/linear-regression.html">å›å½’åˆ†æ</a></li>
    </ul>
  </div>
</div>

## é¡¹ç›®èƒŒæ™¯

é”€å”®é¢é¢„æµ‹æ˜¯ä¼ä¸šè¿è¥ä¸­çš„å…³é”®ä»»åŠ¡ï¼Œå‡†ç¡®çš„é¢„æµ‹å¯ä»¥å¸®åŠ©ä¼ä¸šä¼˜åŒ–åº“å­˜ç®¡ç†ã€äººåŠ›èµ„æºè§„åˆ’å’Œè¥é”€ç­–ç•¥ã€‚é€šè¿‡åˆ†æå†å²é”€å”®æ•°æ®å’Œç›¸å…³å› ç´ ï¼ˆå¦‚ä¿ƒé”€æ´»åŠ¨ã€å­£èŠ‚æ€§ã€ä»·æ ¼å˜åŠ¨ç­‰ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥æ„å»ºæ¨¡å‹æ¥é¢„æµ‹æœªæ¥çš„é”€å”®è¡¨ç°ã€‚

åœ¨è¿™ä¸ªé¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨é›¶å”®å•†çš„é”€å”®æ•°æ®ï¼Œæ„å»ºä¸€ä¸ªé”€å”®é¢é¢„æµ‹æ¨¡å‹ï¼Œå¸®åŠ©ä¼ä¸šåšå‡ºæ›´æ˜æ™ºçš„å†³ç­–ã€‚

<div class="knowledge-card">
  <div class="knowledge-card__title">
    <span class="icon">ğŸ’¡</span>ä½ çŸ¥é“å—ï¼Ÿ
  </div>
  <div class="knowledge-card__content">
    <p>æ²ƒå°”ç›ç­‰å¤§å‹é›¶å”®å•†æ¯å¤©å¤„ç†æ•°ç™¾ä¸‡ç¬”äº¤æ˜“ï¼Œä»–ä»¬ä½¿ç”¨å…ˆè¿›çš„é¢„æµ‹æ¨¡å‹æ¥ä¼˜åŒ–åº“å­˜å’Œå®šä»·ã€‚æ®ä¼°è®¡ï¼Œå‡†ç¡®çš„é”€å”®é¢„æµ‹æ¯å¹´å¯ä»¥ä¸ºå¤§å‹é›¶å”®å•†èŠ‚çœæ•°ç™¾ä¸‡ç¾å…ƒçš„åº“å­˜æˆæœ¬ï¼Œå¹¶æ˜¾è‘—å‡å°‘äº§å“æµªè´¹ã€‚</p>
  </div>
</div>

## æ•°æ®é›†ä»‹ç»

æˆ‘ä»¬å°†ä½¿ç”¨ä¸€ä¸ªé›¶å”®é”€å”®æ•°æ®é›†ï¼ŒåŒ…å«æŸè¿é”è¶…å¸‚ä¸¤å¹´å†…çš„æ¯æ—¥é”€å”®è®°å½•ã€‚æ•°æ®é›†åŒ…å«ä»¥ä¸‹ç‰¹å¾ï¼š

- Dateï¼šé”€å”®æ—¥æœŸ
- Storeï¼šå•†åº—ID
- Itemï¼šå•†å“ID
- Salesï¼šé”€å”®æ•°é‡
- Priceï¼šå•†å“ä»·æ ¼
- Promotionï¼šæ˜¯å¦æœ‰ä¿ƒé”€æ´»åŠ¨ï¼ˆ1è¡¨ç¤ºæœ‰ï¼Œ0è¡¨ç¤ºæ— ï¼‰
- Holidayï¼šæ˜¯å¦æ˜¯å‡æ—¥ï¼ˆ1è¡¨ç¤ºæ˜¯ï¼Œ0è¡¨ç¤ºå¦ï¼‰
- Temperatureï¼šå½“å¤©æ¸©åº¦
- Fuel_Priceï¼šç‡ƒæ²¹ä»·æ ¼
- CPIï¼šæ¶ˆè´¹è€…ä»·æ ¼æŒ‡æ•°
- Unemploymentï¼šå¤±ä¸šç‡

ç›®æ ‡å˜é‡æ˜¯Salesï¼ˆé”€å”®æ•°é‡ï¼‰ï¼Œæˆ‘ä»¬çš„ä»»åŠ¡æ˜¯é¢„æµ‹æœªæ¥ä¸€æ®µæ—¶é—´å†…çš„é”€å”®é‡ã€‚

## é¡¹ç›®ç›®æ ‡

1. æ„å»ºä¸€ä¸ªèƒ½å¤Ÿå‡†ç¡®é¢„æµ‹é”€å”®é¢çš„å›å½’æ¨¡å‹
2. è¯†åˆ«å½±å“é”€å”®çš„å…³é”®å› ç´ 
3. åˆ†æå­£èŠ‚æ€§å’Œè¶‹åŠ¿å¯¹é”€å”®çš„å½±å“
4. è¯„ä¼°ä¸åŒé¢„æµ‹æ–¹æ³•çš„æ€§èƒ½
5. æä¾›é”€å”®é¢„æµ‹çš„å¯è§†åŒ–å’Œä¸šåŠ¡å»ºè®®

## å®æ–½æ­¥éª¤

### 1. æ•°æ®æ¢ç´¢ä¸å¯è§†åŒ–

é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦äº†è§£æ•°æ®çš„åŸºæœ¬ç‰¹å¾å’Œåˆ†å¸ƒï¼š

```python
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns
from sklearn.model_selection import train_test_split
from sklearn.preprocessing import StandardScaler
from sklearn.linear_model import LinearRegression
from sklearn.ensemble import RandomForestRegressor
from sklearn.metrics import mean_squared_error, r2_score, mean_absolute_error
import statsmodels.api as sm
from statsmodels.tsa.seasonal import seasonal_decompose

# åŠ è½½æ•°æ®
df = pd.read_csv('retail_sales.csv')

# å°†æ—¥æœŸåˆ—è½¬æ¢ä¸ºæ—¥æœŸç±»å‹
df['Date'] = pd.to_datetime(df['Date'])

# æŸ¥çœ‹æ•°æ®åŸºæœ¬ä¿¡æ¯
print(df.info())
print(df.describe())

# æ£€æŸ¥ç¼ºå¤±å€¼
print(df.isnull().sum())

# å¯è§†åŒ–é”€å”®è¶‹åŠ¿
plt.figure(figsize=(12, 6))
sales_by_date = df.groupby('Date')['Sales'].sum().reset_index()
plt.plot(sales_by_date['Date'], sales_by_date['Sales'])
plt.title('æ¯æ—¥æ€»é”€å”®é‡è¶‹åŠ¿')
plt.xlabel('æ—¥æœŸ')
plt.ylabel('é”€å”®é‡')
plt.grid(True)
plt.show()

# æŸ¥çœ‹é”€å”®çš„å­£èŠ‚æ€§æ¨¡å¼
plt.figure(figsize=(12, 6))
sales_by_month = df.groupby(df['Date'].dt.month)['Sales'].mean().reset_index()
plt.bar(sales_by_month['Date'], sales_by_month['Sales'])
plt.title('æœˆåº¦å¹³å‡é”€å”®é‡')
plt.xlabel('æœˆä»½')
plt.ylabel('å¹³å‡é”€å”®é‡')
plt.xticks(range(1, 13))
plt.grid(True, axis='y')
plt.show()

# æŸ¥çœ‹ä¿ƒé”€æ´»åŠ¨å¯¹é”€å”®çš„å½±å“
plt.figure(figsize=(10, 6))
sns.boxplot(x='Promotion', y='Sales', data=df)
plt.title('ä¿ƒé”€æ´»åŠ¨å¯¹é”€å”®çš„å½±å“')
plt.xlabel('æ˜¯å¦æœ‰ä¿ƒé”€')
plt.ylabel('é”€å”®é‡')
plt.show()

# æŸ¥çœ‹æ¸©åº¦å¯¹é”€å”®çš„å½±å“
plt.figure(figsize=(10, 6))
plt.scatter(df['Temperature'], df['Sales'], alpha=0.5)
plt.title('æ¸©åº¦ä¸é”€å”®é‡çš„å…³ç³»')
plt.xlabel('æ¸©åº¦')
plt.ylabel('é”€å”®é‡')
plt.grid(True)
plt.show()
```

### 2. ç‰¹å¾å·¥ç¨‹

åˆ›å»ºæœ‰åŠ©äºé¢„æµ‹çš„æ–°ç‰¹å¾ï¼š

```python
# ä»æ—¥æœŸæå–æ—¶é—´ç‰¹å¾
df['Year'] = df['Date'].dt.year
df['Month'] = df['Date'].dt.month
df['Day'] = df['Date'].dt.day
df['DayOfWeek'] = df['Date'].dt.dayofweek
df['WeekOfYear'] = df['Date'].dt.isocalendar().week

# åˆ›å»ºå­£èŠ‚ç‰¹å¾
df['Season'] = df['Month'].apply(lambda x: 1 if x in [12, 1, 2] else 
                                          2 if x in [3, 4, 5] else 
                                          3 if x in [6, 7, 8] else 4)

# åˆ›å»ºæ˜¯å¦å‘¨æœ«ç‰¹å¾
df['IsWeekend'] = df['DayOfWeek'].apply(lambda x: 1 if x >= 5 else 0)

# åˆ›å»ºæ»åç‰¹å¾ï¼ˆå‰ä¸€å¤©ã€å‰ä¸€å‘¨çš„é”€å”®é‡ï¼‰
df_lag = df.copy()
df_lag = df_lag.sort_values(['Store', 'Item', 'Date'])
df_lag['Sales_Lag1'] = df_lag.groupby(['Store', 'Item'])['Sales'].shift(1)
df_lag['Sales_Lag7'] = df_lag.groupby(['Store', 'Item'])['Sales'].shift(7)

# ç§»é™¤åŒ…å«NaNçš„è¡Œï¼ˆç”±äºåˆ›å»ºæ»åç‰¹å¾ï¼‰
df_lag = df_lag.dropna()

# æŸ¥çœ‹æ–°ç‰¹å¾
print(df_lag.head())
```

### 3. æ—¶é—´åºåˆ—åˆ†è§£

åˆ†æé”€å”®æ•°æ®çš„è¶‹åŠ¿ã€å­£èŠ‚æ€§å’Œæ®‹å·®æˆåˆ†ï¼š

```python
# é€‰æ‹©ä¸€ä¸ªç‰¹å®šå•†åº—å’Œå•†å“çš„é”€å”®æ•°æ®è¿›è¡Œæ—¶é—´åºåˆ—åˆ†è§£
store_item_sales = df[(df['Store'] == 1) & (df['Item'] == 1)].set_index('Date')['Sales']

# ç¡®ä¿ç´¢å¼•æ˜¯ç­‰é—´éš”çš„
store_item_sales = store_item_sales.asfreq('D')

# æ—¶é—´åºåˆ—åˆ†è§£
decomposition = seasonal_decompose(store_item_sales, model='multiplicative', period=7)

# å¯è§†åŒ–åˆ†è§£ç»“æœ
fig, (ax1, ax2, ax3, ax4) = plt.subplots(4, 1, figsize=(12, 10))
decomposition.observed.plot(ax=ax1)
ax1.set_title('è§‚æµ‹å€¼')
decomposition.trend.plot(ax=ax2)
ax2.set_title('è¶‹åŠ¿')
decomposition.seasonal.plot(ax=ax3)
ax3.set_title('å­£èŠ‚æ€§')
decomposition.resid.plot(ax=ax4)
ax4.set_title('æ®‹å·®')
plt.tight_layout()
plt.show()
```

### 4. æ¨¡å‹è®­ç»ƒä¸è¯„ä¼°

æˆ‘ä»¬å°†å°è¯•å¤šç§å›å½’æ¨¡å‹ï¼Œå¹¶æ¯”è¾ƒå®ƒä»¬çš„æ€§èƒ½ï¼š

```python
# å‡†å¤‡ç‰¹å¾å’Œç›®æ ‡å˜é‡
X = df_lag.drop(['Date', 'Sales'], axis=1)
y = df_lag['Sales']

# å°†åˆ†ç±»å˜é‡è½¬æ¢ä¸ºå“‘å˜é‡
X = pd.get_dummies(X, columns=['Store', 'Item', 'Season'], drop_first=True)

# åˆ’åˆ†è®­ç»ƒé›†å’Œæµ‹è¯•é›†ï¼ˆæŒ‰æ—¶é—´é¡ºåºï¼‰
train_size = int(len(X) * 0.8)
X_train, X_test = X[:train_size], X[train_size:]
y_train, y_test = y[:train_size], y[train_size:]

# ç‰¹å¾æ ‡å‡†åŒ–
scaler = StandardScaler()
X_train_scaled = scaler.fit_transform(X_train)
X_test_scaled = scaler.transform(X_test)

# å®šä¹‰è¯„ä¼°å‡½æ•°
def evaluate_model(model, X_train, X_test, y_train, y_test, model_name):
    # è®­ç»ƒæ¨¡å‹
    model.fit(X_train, y_train)
    
    # é¢„æµ‹
    y_train_pred = model.predict(X_train)
    y_test_pred = model.predict(X_test)
    
    # è®¡ç®—è¯„ä¼°æŒ‡æ ‡
    train_rmse = np.sqrt(mean_squared_error(y_train, y_train_pred))
    test_rmse = np.sqrt(mean_squared_error(y_test, y_test_pred))
    train_r2 = r2_score(y_train, y_train_pred)
    test_r2 = r2_score(y_test, y_test_pred)
    test_mae = mean_absolute_error(y_test, y_test_pred)
    
    print(f"{model_name}:")
    print(f"è®­ç»ƒé›†RMSE: {train_rmse:.2f}")
    print(f"æµ‹è¯•é›†RMSE: {test_rmse:.2f}")
    print(f"è®­ç»ƒé›†RÂ²: {train_r2:.2f}")
    print(f"æµ‹è¯•é›†RÂ²: {test_r2:.2f}")
    print(f"æµ‹è¯•é›†MAE: {test_mae:.2f}")
    
    return model, y_test_pred

# çº¿æ€§å›å½’
lr_model, lr_pred = evaluate_model(LinearRegression(), X_train_scaled, X_test_scaled, y_train, y_test, "çº¿æ€§å›å½’æ¨¡å‹")
print("\n")

# éšæœºæ£®æ—å›å½’
rf_model, rf_pred = evaluate_model(RandomForestRegressor(n_estimators=100, max_depth=10, random_state=42), 
                                  X_train, X_test, y_train, y_test, "éšæœºæ£®æ—å›å½’æ¨¡å‹")
```

### 5. ç‰¹å¾é‡è¦æ€§åˆ†æ

äº†è§£å“ªäº›å› ç´ å¯¹é”€å”®å½±å“æœ€å¤§ï¼š

```python
# ä½¿ç”¨éšæœºæ£®æ—æ¨¡å‹åˆ†æç‰¹å¾é‡è¦æ€§
feature_importance = pd.DataFrame({
    'Feature': X.columns,
    'Importance': rf_model.feature_importances_
})
feature_importance = feature_importance.sort_values('Importance', ascending=False)

# æ˜¾ç¤ºå‰15ä¸ªæœ€é‡è¦çš„ç‰¹å¾
plt.figure(figsize=(12, 8))
sns.barplot(x='Importance', y='Feature', data=feature_importance.head(15))
plt.title('ç‰¹å¾é‡è¦æ€§ï¼ˆå‰15åï¼‰')
plt.tight_layout()
plt.show()
```

### 6. é¢„æµ‹å¯è§†åŒ–

å¯è§†åŒ–æ¨¡å‹é¢„æµ‹ç»“æœä¸å®é™…å€¼çš„å¯¹æ¯”ï¼š

```python
# å¯è§†åŒ–é¢„æµ‹ç»“æœ
plt.figure(figsize=(12, 6))
plt.plot(y_test.values, label='å®é™…é”€å”®é‡')
plt.plot(rf_pred, label='é¢„æµ‹é”€å”®é‡', alpha=0.7)
plt.title('éšæœºæ£®æ—æ¨¡å‹ï¼šå®é™…é”€å”®é‡ vs é¢„æµ‹é”€å”®é‡')
plt.xlabel('æ ·æœ¬ç´¢å¼•')
plt.ylabel('é”€å”®é‡')
plt.legend()
plt.grid(True)
plt.show()

# é¢„æµ‹è¯¯å·®åˆ†æ
errors = y_test - rf_pred
plt.figure(figsize=(12, 6))
plt.hist(errors, bins=50)
plt.title('é¢„æµ‹è¯¯å·®åˆ†å¸ƒ')
plt.xlabel('é¢„æµ‹è¯¯å·®')
plt.ylabel('é¢‘ç‡')
plt.grid(True)
plt.show()
```

## è¿›é˜¶æŒ‘æˆ˜

å¦‚æœä½ å·²ç»å®Œæˆäº†åŸºæœ¬ä»»åŠ¡ï¼Œå¯ä»¥å°è¯•ä»¥ä¸‹è¿›é˜¶æŒ‘æˆ˜ï¼š

1. **é«˜çº§æ—¶é—´åºåˆ—æ¨¡å‹**ï¼šå°è¯•ä½¿ç”¨ARIMAã€SARIMAæˆ–Prophetç­‰ä¸“é—¨çš„æ—¶é—´åºåˆ—æ¨¡å‹
2. **å¤šæ­¥é¢„æµ‹**ï¼šæ„å»ºèƒ½å¤Ÿé¢„æµ‹æœªæ¥å¤šä¸ªæ—¶é—´ç‚¹é”€å”®é‡çš„æ¨¡å‹
3. **é›†æˆé¢„æµ‹**ï¼šç»“åˆå¤šä¸ªæ¨¡å‹çš„é¢„æµ‹ç»“æœï¼Œæé«˜é¢„æµ‹å‡†ç¡®æ€§
4. **ç‰¹å¾é€‰æ‹©**ï¼šä½¿ç”¨ç‰¹å¾é€‰æ‹©æŠ€æœ¯ï¼Œæ‰¾å‡ºæœ€æœ‰é¢„æµ‹åŠ›çš„ç‰¹å¾å­é›†
5. **äº¤å‰éªŒè¯**ï¼šå®ç°æ—¶é—´åºåˆ—äº¤å‰éªŒè¯ï¼Œè·å¾—æ›´ç¨³å¥çš„æ¨¡å‹è¯„ä¼°

## å°ç»“ä¸åæ€

é€šè¿‡è¿™ä¸ªé¡¹ç›®ï¼Œæˆ‘ä»¬å­¦ä¹ äº†å¦‚ä½•æ„å»ºé”€å”®é¢é¢„æµ‹æ¨¡å‹ï¼Œä»æ•°æ®æ¢ç´¢åˆ°æ¨¡å‹è¯„ä¼°çš„å®Œæ•´æµç¨‹ã€‚æˆ‘ä»¬å‘ç°ä¿ƒé”€æ´»åŠ¨ã€å­£èŠ‚æ€§å’Œå†å²é”€å”®æ•°æ®å¯¹é¢„æµ‹æœªæ¥é”€å”®æœ‰æ˜¾è‘—å½±å“ã€‚

åœ¨å®é™…åº”ç”¨ä¸­ï¼Œé”€å”®é¢„æµ‹æ¨¡å‹å¯ä»¥å¸®åŠ©ä¼ä¸šä¼˜åŒ–åº“å­˜ç®¡ç†ï¼Œå‡å°‘åº“å­˜æˆæœ¬å’Œäº§å“æµªè´¹ï¼ŒåŒæ—¶ç¡®ä¿äº§å“ä¾›åº”å……è¶³ï¼Œæ»¡è¶³å®¢æˆ·éœ€æ±‚ã€‚æ­¤å¤–ï¼Œå‡†ç¡®çš„é”€å”®é¢„æµ‹è¿˜å¯ä»¥å¸®åŠ©ä¼ä¸šåˆ¶å®šæ›´æœ‰æ•ˆçš„è¥é”€ç­–ç•¥å’Œä¿ƒé”€è®¡åˆ’ã€‚

### æ€è€ƒé—®é¢˜

1. é™¤äº†æˆ‘ä»¬ä½¿ç”¨çš„ç‰¹å¾å¤–ï¼Œè¿˜æœ‰å“ªäº›å› ç´ å¯èƒ½å½±å“é”€å”®ï¼Ÿå¦‚ä½•è·å–è¿™äº›æ•°æ®ï¼Ÿ
2. é”€å”®é¢„æµ‹æ¨¡å‹åœ¨å“ªäº›æƒ…å†µä¸‹å¯èƒ½å¤±æ•ˆï¼Ÿå¦‚ä½•åº”å¯¹è¿™äº›æŒ‘æˆ˜ï¼Ÿ
3. å¦‚ä½•å°†é”€å”®é¢„æµ‹ç»“æœè½¬åŒ–ä¸ºå…·ä½“çš„ä¸šåŠ¡å†³ç­–å’Œè¡ŒåŠ¨ï¼Ÿ

<div class="practice-link">
  <a href="/projects/regression/anomaly-detection.html" class="button">ä¸‹ä¸€ä¸ªé¡¹ç›®ï¼šå¼‚å¸¸æ£€æµ‹ä¸é¢„æµ‹</a>
</div> 